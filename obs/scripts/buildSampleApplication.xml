<project name="SampleApplication" default="buildSampleApplication" basedir="..">
    <description>
        Ant build file to generate the code for the sample application for the OBS Framework.
        The individual ant commands process the sample application model and use it to
        construct application specific classes and to construct the component factory for the
        sample application.
    </description>
    
  <!-- set global properties for this build -->
  <property name="GenHomeDir" location="src/xsl"/>
  <property name="GenInpDir" location="src/xml"/>
  <property name="GenTargetDir" location="src/cpp"/>
  <property name="ApplicationModel" location="src/xml/SampleApplicationModel.xml"/>

  <target name="init">
    <tstamp/>
  </target>

  <target name="BuildSampleApplication">
    <antcall target="genSampleParDB"/>
    <antcall target="genSampleDP"/>
    <antcall target="genFsmStateClasses"/>
    <antcall target="genControlBlockClasses"/>
    <antcall target="genRecoveryActionClasses"/>
    <antcall target="genMonitoringProfileClasses"/>
    <antcall target="genSampleCompFactory"/>
  </target>

  <target name="genSampleParDB" description="generate the parameter database class for the sample application">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleParameterDatabase_header.txt" 
                                                style="${GenHomeDir}/GenerateParameterDatabaseHeader.xsl"/>
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleParameterDatabase_body.txt" 
                                                style="${GenHomeDir}/GenerateParameterDatabaseBody.xsl"/>
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleParameterDatabase_include.txt" 
                                                style="${GenHomeDir}/GenerateParameterDatabaseInclude.xsl"/>
  </target>

  <target name="genSampleDP" description="generate the data pool class for the sample application">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleDataPool_header.txt" 
                                                style="${GenHomeDir}/GenerateDataPoolHeader.xsl"/>
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleDataPool_body.txt" 
                                                style="${GenHomeDir}/GenerateDataPoolBody.xsl"/>
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleDataPool_include.txt" 
                                                style="${GenHomeDir}/GenerateDataPoolInclude.xsl"/>
  </target>

  <target name="genSampleCompFactory" description="generate the component factory for the sample application">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleApplication/CC_ComponentFactory.h" 
                                                style="${GenHomeDir}/GenerateComponentFactoryHeader.xsl"/>
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleApplication/CC_ComponentFactory_inc.h" 
                                                style="${GenHomeDir}/GenerateComponentFactoryInclude.xsl"/>
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/SampleApplication/CC_ComponentFactory.cpp" 
                                                style="${GenHomeDir}/GenerateComponentFactoryBody.xsl"/>
  </target>

  <target name="genFsmStateClasses" description="generate the application-specific FsmState classes">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/FsmStateLog.txt" 
                                                style="${GenHomeDir}/GenerateFsmState.xsl"/>
  </target>

  <target name="genControlBlockClasses" description="generate the application-specific control block classes">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/ControlBlockLog.txt" 
                                                style="${GenHomeDir}/GenerateControlBlock.xsl"/>
  </target>

  <target name="genRecoveryActionClasses" description="generate the application-specific recovery action classes">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/RecoveryActionLog.txt" 
                                                style="${GenHomeDir}/GenerateRecoveryAction.xsl"/>
  </target>

  <target name="genMonitoringProfileClasses" description="generate the application-specific monitoring profile classes">
    <xslt force="true" in="${ApplicationModel}" out="${GenTargetDir}/MonitoringProfileLog.txt" 
                                                style="${GenHomeDir}/GenerateMonitoringProfile.xsl"/>
  </target>

  <target name="delete" description="delete all files generated by the generator meta-components" >
    <delete>
      <fileset dir="src/cpp/">
        <include name="Data/DC_Sample*ControlBlock*.*"/>
        <include name="Data/DC_Sample*Database*.*"/>
        <include name="Data/DC_Sample*DataPool*.*"/>
        <include name="Data/DC_Matlab*.*"/>
        <include name="System/CC_*Stack.*"/>
        <include name="Telemetry/CC_TelemetryPacketFactory.*"/>
        <include name="Telecommand/CC_TelecommandFactory.*"/>
        <include name="Manoeuvre/CC_ManoeuvreFactory.*"/>
        <include name="SampleApplication/CC_ComponentFactory*.*"/>
        <include name="*Log*.txt"/>
      </fileset>
    </delete>
  </target>

</project>
