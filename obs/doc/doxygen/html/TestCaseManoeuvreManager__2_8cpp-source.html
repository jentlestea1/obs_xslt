<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseManoeuvreManager_2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseManoeuvreManager_2.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseManoeuvreManager_2.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         08.05.03</span>
00008 <span class="comment">// Author       R. Totaro</span>
00009 
00010 <span class="preprocessor">#include "TestCaseManoeuvreManager_2.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00014 <span class="preprocessor">#include "../Manoeuvre/DC_DummyConfigurableManoeuvre.h"</span>
00015 <span class="preprocessor">#include "../Manoeuvre/CC_ManoeuvreManager.h"</span>
00016 
00017 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> nMan=5;
00018 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keywordtype">int</span> maxActivations=100;
00019 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{
00020         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> continueToFalse;
00021         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> finishedToTrue;
00022 } manoeuvreStateChange[nMan]={
00023         { 5,4},  <span class="comment">// Manouvre finishes after 4 calls to doContinue()</span>
00024         { 4,3},  <span class="comment">// Manouvre finishes after 3 calls to doContinue()</span>
00025         { 6,7},  <span class="comment">// Continuation flag set to false after 6 calls to doContinue()</span>
00026         {10,9},  <span class="comment">// Manouvre finishes after 9 calls to doContinue()</span>
00027         { 8,9}   <span class="comment">// Continuation flag set to false after 6 calls to doContinue()</span>
00028 };
00029 <span class="keyword">static</span> <span class="keyword">const</span> <span class="keyword">struct </span>{
00030         <span class="keywordtype">int</span>          activation;
00031         <a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a> eventType;
00032         <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset;
00033 } expectedEvent[nMan]={
00034         { 4,EVT_MAN_TERMINATED,2*nMan+1},
00035         { 5,EVT_MAN_TERMINATED,2*nMan+3},
00036         { 7,EVT_MAN_ABORTED,   2*nMan+5},
00037         { 9,EVT_MAN_ABORTED,   2*nMan+7},
00038         {10,EVT_MAN_TERMINATED,2*nMan+9}
00039 };
00040 
<a name="l00041"></a><a class="code" href="classTestCaseManoeuvreManager__2.html#a0">00041</a> <a class="code" href="classTestCaseManoeuvreManager__2.html#a0">TestCaseManoeuvreManager_2::TestCaseManoeuvreManager_2</a>(<span class="keywordtype">void</span>) :
00042         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_MANOEUVREMANAGER*10+2,"<a class="code" href="classTestCaseManoeuvreManager__2.html">TestCaseManoeuvreManager_2</a>") {
00043         <span class="keywordflow">return</span>;
00044 }
00045 
<a name="l00046"></a><a class="code" href="classTestCaseManoeuvreManager__2.html#a1">00046</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseManoeuvreManager__2.html#a1">TestCaseManoeuvreManager_2::runTestCase</a>(<span class="keywordtype">void</span>) {
00047     <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a>           *pMM =<span class="keyword">new</span> <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a>();
00048     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>             nEvt=this-&gt;<a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00049         <a class="code" href="classDC__DummyConfigurableManoeuvre.html">DC_DummyConfigurableManoeuvre</a> *pDCM[nMan];
00050 
00051         <span class="comment">// Initialize the manoeuvre manager</span>
00052         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a2">setPendingManoeuvreListSize</a>(nMan);
00053 
00054         <span class="comment">// Allocate, load and set the start and continuation flag of the nMan manoeuvres</span>
00055         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nMan;i++) {
00056                 pDCM[i]=<span class="keyword">new</span> <a class="code" href="classDC__DummyConfigurableManoeuvre.html">DC_DummyConfigurableManoeuvre</a>();
00057         pDCM[i]-&gt;<a class="code" href="classManoeuvre.html#a9">setInUse</a>(<span class="keyword">true</span>);
00058                 pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a5">load</a>(pDCM[i]);
00059         pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a5">setStartCheckStatus</a>(<a class="code" href="Constants_8h.html#a16">MAN_CAN_START</a>);
00060         pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a6">setContinuationCheckStatus</a>(<a class="code" href="Constants_8h.html#a18">MAN_CAN_CONTINUE</a>);
00061         pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a9">setTerminationCheckStatus</a>(<a class="code" href="Constants_8h.html#a21">MAN_HAS_NOT_TERMINATED</a>);
00062         }
00063 
00064         <span class="comment">// Invoke once the activate method and verify that the manoeuvres</span>
00065         <span class="comment">// have been initialized and that doContinue() has been called.</span>
00066         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a7">activate</a>();
00067         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nMan;i++) {
00068                 <span class="keywordflow">if</span> (pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a10">getInitializationActionCounter</a>()!=1) {
00069                         setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Failed to initialize the manoeuvres"</span>);
00070                         <span class="keywordflow">return</span>;
00071                 }
00072 
00073                 <span class="keywordflow">if</span> (pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a11">getContinuationActionCounter</a>()!=1) {
00074                         setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Failed to call doContinue()"</span>);
00075                         <span class="keywordflow">return</span>;
00076                 }
00077         }
00078 
00079         <span class="comment">// Now let's loop until all the manoeuvres have finished or the</span>
00080         <span class="comment">// maximum number of activations has been reached.</span>
00081         <span class="comment">// The initial value is 1: pMM-&gt;activate() has already been called once.</span>
00082         <span class="keywordtype">int</span> activationCalls=1;
00083 
00084         <span class="keywordflow">do</span> {
00085                 <span class="comment">// Update the manoeuvres' status</span>
00086                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nMan;i++) {
00087                         <span class="keywordflow">if</span> (pDCM[i]-&gt;<a class="code" href="classManoeuvre.html#a10">isInUse</a>()) {
00088                                 <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n=pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a11">getContinuationActionCounter</a>();
00089 
00090                                 pDCM[i]-&gt;setStartCheckStatus(<a class="code" href="Constants_8h.html#a16">MAN_CAN_START</a>);
00091                                 pDCM[i]-&gt;setContinuationCheckStatus((n&lt;manoeuvreStateChange[i].continueToFalse));
00092                                 pDCM[i]-&gt;setTerminationCheckStatus((n&gt;=manoeuvreStateChange[i].finishedToTrue));
00093                         }
00094                 }
00095 
00096                 pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a7">activate</a>();
00097                 activationCalls++;
00098 
00099                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nMan;i++) {
00100                         <span class="comment">// Verify that all the manoeuvres in use have been scheduled</span>
00101                         <span class="keywordflow">if</span> (pDCM[i]-&gt;<a class="code" href="classManoeuvre.html#a10">isInUse</a>()) {
00102                                 <span class="keywordflow">if</span> (pDCM[i]-&gt;<a class="code" href="classDC__DummyConfigurableManoeuvre.html#a11">getContinuationActionCounter</a>()!=activationCalls) {
00103                                         setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Failed to call doContinue()"</span>);
00104                                         <span class="keywordflow">return</span>;
00105                                 }
00106                         }
00107 
00108                         <span class="comment">// Now we verify that the manoeuvre has been terminated/aborted</span>
00109                         <span class="comment">// (depending on its status) and unloaded from the manoeuvre manager.</span>
00110                         <span class="comment">// The easiest way to do this is to look in the event repository for</span>
00111                         <span class="comment">// the corresponding events.</span>
00112                         <span class="keywordflow">if</span> (expectedEvent[i].activation==activationCalls &amp;&amp;
00113                                 (!verifySpecificEvent(nEvt+expectedEvent[i].offset,
00114                                                                           expectedEvent[i].eventType) ||
00115                                  !verifyLatestEvent(nEvt+expectedEvent[i].offset+1,
00116                                                                         EVT_MAN_UNLOADED))) {
00117                                 <span class="keywordflow">return</span>;
00118                         }
00119                 }
00120         } <span class="keywordflow">while</span> (pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a4">getPendingManoeuvres</a>()&gt;0 &amp;&amp; activationCalls&lt;maxActivations);
00121 
00122         <span class="keywordflow">if</span> (activationCalls==maxActivations) {
00123                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Maximum number of activations reached"</span>);
00124                 <span class="keywordflow">return</span>;
00125         }
00126 
00127         setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00128         <span class="keywordflow">return</span>;
00129 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
