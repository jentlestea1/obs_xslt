<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCasePUSMemoryDumpOffset_1.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCasePUSMemoryDumpOffset_1.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCasePUSMemoryDumpOffset_1.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         04.02.04</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../Telemetry/DC_PUSMemoryDumpOffset.h"</span>
00015 <span class="preprocessor">#include "../Utilities/TestCaseWithEvtCheck.h"</span>
00016 <span class="preprocessor">#include "TestCasePUSMemoryDumpOffset_1.h"</span>
00017 
00018 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00019 <span class="preprocessor">#include &lt;string.h&gt;</span>
00020 
<a name="l00021"></a><a class="code" href="classTestCasePUSMemoryDumpOffset__1.html#a0">00021</a> <a class="code" href="classTestCasePUSMemoryDumpOffset__1.html#a0">TestCasePUSMemoryDumpOffset_1::TestCasePUSMemoryDumpOffset_1</a>(<span class="keywordtype">void</span>) :
00022         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_PUSMEMORYDUMPOFFSET*10+1,"<a class="code" href="classTestCasePUSMemoryDumpOffset__1.html">TestCasePUSMemoryDumpOffset_1</a>") {
00023                 <span class="keywordflow">return</span>;
00024 }
00025 
<a name="l00026"></a><a class="code" href="classTestCasePUSMemoryDumpOffset__1.html#a1">00026</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSMemoryDumpOffset__1.html#a1">TestCasePUSMemoryDumpOffset_1::runTestCase</a>(<span class="keywordtype">void</span>) {
00027 
00028    <a class="code" href="classDC__PUSMemoryDumpOffset.html">DC_PUSMemoryDumpOffset</a>* pMD = <span class="keyword">new</span> <a class="code" href="classDC__PUSMemoryDumpOffset.html">DC_PUSMemoryDumpOffset</a>();
00029 
00030    <span class="comment">// Set dummy values for the configuration parameters defined at</span>
00031    <span class="comment">// the level of telemetry packet and PUS telemmetry packet superclasses</span>
00032    pMD-&gt;<a class="code" href="classPUSTelemetryPacket.html#a7">setTimeTag</a>(0);
00033    pMD-&gt;<a class="code" href="classPUSTelemetryPacket.html#a3">setDestination</a>(1);
00034 
00035    <span class="comment">// Memory area from where telemetry data will be collected</span>
00036    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> paSize =100;
00037    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> pa[paSize];
00038    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> i=0; i&lt;paSize; i++)
00039         pa[i]=i;
00040 
00041    <span class="comment">// Data area for the telemetry packet packet</span>
00042    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> defPacketSize = 100;
00043    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> packet[defPacketSize];
00044 
00045    <span class="comment">// Check the correctness of the class identifier</span>
00046    <span class="keywordflow">if</span> ( (pMD-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>() != ID_PUSMEMORYDUMPOFFSET) )
00047    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong class identifier"</span>);
00048         <span class="keywordflow">return</span>;
00049    }
00050 
00051    <span class="comment">// Check the correctness of the type and subtype</span>
00052    <span class="keywordflow">if</span> ( (pMD-&gt;<a class="code" href="classPUSTelemetryPacket.html#a4">getType</a>() != 6) || (pMD-&gt;<a class="code" href="classPUSTelemetryPacket.html#a5">getSubType</a>() != 4) )
00053    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong type or subtype"</span>);
00054         <span class="keywordflow">return</span>;
00055    }
00056 
00057    <span class="comment">// Check configuration status</span>
00058    <span class="keywordflow">if</span> ( pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a17">isObjectConfigured</a>() )
00059    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration status at initialization"</span>);
00060         <span class="keywordflow">return</span>;
00061    }
00062 
00063    <span class="comment">// Set maximum number of blocks</span>
00064    <a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a> numberBlocks = 3;
00065    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a1">setMaxNumberBlocks</a>(numberBlocks);
00066    <span class="keywordflow">if</span> ( pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a2">getMaxNumberBlocks</a>()!=numberBlocks )
00067    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration parameter"</span>);
00068         <span class="keywordflow">return</span>;
00069    }
00070 
00071    <span class="comment">// Set maximum number of data</span>
00072    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> maxNumberData = 50;
00073    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a5">setDumpBufferSize</a>(maxNumberData);
00074    <span class="keywordflow">if</span> ( pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a6">getDumpBufferSize</a>()!=maxNumberData )
00075    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration parameter"</span>);
00076         <span class="keywordflow">return</span>;
00077    }
00078 
00079    <span class="comment">// Check configuration status</span>
00080    <span class="keywordflow">if</span> ( !pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a17">isObjectConfigured</a>() )
00081    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration status after initialization"</span>);
00082         <span class="keywordflow">return</span>;
00083    }
00084 
00085    <span class="comment">// Check initial value of checksum flag</span>
00086    <span class="keywordflow">if</span> ( pMD-&gt;<a class="code" href="classPUSMemoryDump.html#e1">isChecksumFlagSet</a>() )
00087    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong value of checksum flag"</span>);
00088         <span class="keywordflow">return</span>;
00089    }
00090 
00091    <span class="comment">// Set base address and check success</span>
00092    pMD-&gt;<a class="code" href="classDC__PUSMemoryDumpOffset.html#a1">setBaseAddress</a>(pa);
00093    <span class="keywordflow">if</span> ( pMD-&gt;<a class="code" href="classDC__PUSMemoryDumpOffset.html#a2">getBaseAddress</a>()!=pa )
00094    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong value of base address"</span>);
00095         <span class="keywordflow">return</span>;
00096    }
00097 
00098    <span class="comment">// Set memory ID and check success</span>
00099    <a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a> memId = 12;
00100    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a15">setMemoryId</a>(memId);
00101    <span class="keywordflow">if</span> ( pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a16">getMemoryId</a>()!=memId )
00102    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong value of memory id"</span>);
00103         <span class="keywordflow">return</span>;
00104    }
00105 
00106    <span class="comment">// Check availability of fast acquisition service</span>
00107    <span class="keywordflow">if</span> ( !pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a11">isFastAcquisitionImplemented</a>() )
00108    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Missing fast acquisition service"</span>);
00109         <span class="keywordflow">return</span>;
00110    }
00111 
00112    <span class="comment">// Configure the packet to dump two blocks of three locations each</span>
00113    <a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a> osa = 2;
00114    <a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a> osb = 5;
00115    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> lena = 2;
00116    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> lenb = 3;
00117    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a3">setNumberBlocks</a>(2);
00118    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a7">defineBlock</a>(0,pa+osa,lena);
00119    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a7">defineBlock</a>(1,pa+osb,lenb);
00120    <span class="keywordflow">if</span> ( (pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a10">getStartAddress</a>(0)!=(pa+osa)) || (pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a10">getStartAddress</a>(1)!=(pa+osb)) )
00121    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong block configuration values"</span>);
00122         <span class="keywordflow">return</span>;
00123    }
00124    <span class="keywordflow">if</span> ( (pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a13">getLength</a>(0)!=lena) || (pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a13">getLength</a>(1)!=lenb) )
00125    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong block configuration values"</span>);
00126         <span class="keywordflow">return</span>;
00127    }
00128 
00129    <span class="comment">// Do a data update</span>
00130    pMD-&gt;<a class="code" href="classDC__PUSMemoryDumpOffset.html#a3">update</a>();
00131 
00132    <span class="comment">// Compute expected size of the telemetry packet</span>
00133    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> fixedLength = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00134    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> blockLength_1 = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>)+
00135                                     <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)+lena*<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00136    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> blockLength_2 = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>)+
00137                                     <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>)+lenb*<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00138    <span class="keywordflow">if</span> (pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a8">getNumberOfBytes</a>()!=(fixedLength+blockLength_1+blockLength_2))
00139    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet size"</span>);
00140         <span class="keywordflow">return</span>;
00141    }
00142 
00143    <span class="comment">// Do data acquisition and check success</span>
00144    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a8">getNumberOfBytes</a>(); i++) 
00145        packet[i]=pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a9">getUnsignedByte</a>(i);
00146 
00147    <span class="keywordtype">bool</span> testFailed = <span class="keyword">false</span>;
00148    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset = 0;
00149    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;memId,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>))!=0 )
00150        testFailed = <span class="keyword">true</span>;
00151    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00152    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>* miTemp = pa;
00153    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;miTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*))!=0 )
00154        testFailed = <span class="keyword">true</span>;
00155    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00156    <a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a> nmbTemp = 2;
00157    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;nmbTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>))!=0 )
00158        testFailed = <span class="keyword">true</span>;
00159    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00160 
00161    <span class="comment">// -- first block --</span>
00162    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;osa,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>))!=0 )
00163        testFailed = <span class="keyword">true</span>;
00164    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>);
00165    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;lena,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>))!=0 )
00166        testFailed = <span class="keyword">true</span>;
00167    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00168    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a> i=osa; i&lt;osa+lena; i++) {
00169         <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> mpTemp = (<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>)(i);
00170         <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;mpTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>))!=0 )
00171             testFailed = <span class="keyword">true</span>;
00172         offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00173    }
00174    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> usTemp = 0;
00175    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;usTemp,2)!=0 )
00176        testFailed = <span class="keyword">true</span>;
00177    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00178 
00179    <span class="comment">// -- second block --</span>
00180    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;osb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>))!=0 )
00181        testFailed = <span class="keyword">true</span>;
00182    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>);
00183    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;lenb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>))!=0 )
00184        testFailed = <span class="keyword">true</span>;
00185    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00186    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a> i=osb; i&lt;osb+lenb; i++) {
00187         <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> mpTemp = (<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>)(i);
00188         <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;mpTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>))!=0 )
00189             testFailed = <span class="keyword">true</span>;
00190         offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00191    }
00192    usTemp = 0;
00193    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;usTemp,2)!=0 )
00194        testFailed = <span class="keyword">true</span>;
00195    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00196    <span class="comment">// -- end second block --</span>
00197 
00198    <span class="keywordflow">if</span> ( testFailed )
00199    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong telemetry packet content"</span>);
00200         <span class="keywordflow">return</span>;
00201    }
00202 
00203    <span class="comment">// Change setting of checksum flag and check success</span>
00204    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#e0">setChecksumFlag</a>(<span class="keyword">true</span>);
00205    <span class="keywordflow">if</span> ( !pMD-&gt;<a class="code" href="classPUSMemoryDump.html#e1">isChecksumFlagSet</a>() )
00206    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong checksum value"</span>);
00207         <span class="keywordflow">return</span>;
00208    }
00209 
00210    <span class="comment">// Configure the packet to dump one block of one location. The offset is chosen to be zero so as</span>
00211    <span class="comment">// to ensure that the dumped location has value zero and its expected checksum is then "FF FF".</span>
00212    osa = 0;
00213    lena = 1;
00214    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a3">setNumberBlocks</a>(1);
00215    pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a7">defineBlock</a>(0,pa+osa,lena);
00216 
00217    <span class="comment">// Do a data update</span>
00218    pMD-&gt;<a class="code" href="classDC__PUSMemoryDumpOffset.html#a3">update</a>();
00219 
00220    <span class="comment">// Do data acquisition and check success</span>
00221    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a8">getNumberOfBytes</a>(); i++) 
00222        packet[i]=pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a9">getUnsignedByte</a>(i);
00223 
00224    testFailed = <span class="keyword">false</span>;
00225    offset = 0;
00226    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;memId,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>))!=0 )
00227        testFailed = <span class="keyword">true</span>;
00228    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00229    miTemp = pa;
00230    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;miTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*))!=0 )
00231        testFailed = <span class="keyword">true</span>;
00232    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00233    nmbTemp = 1;
00234    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;nmbTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>))!=0 )
00235        testFailed = <span class="keyword">true</span>;
00236    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00237 
00238    <span class="comment">// -- first block --</span>
00239    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;osa,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>))!=0 )
00240        testFailed = <span class="keyword">true</span>;
00241    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a>);
00242    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;lena,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>))!=0 )
00243        testFailed = <span class="keyword">true</span>;
00244    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00245    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a> i=osa; i&lt;osa+lena; i++) {
00246         <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> mpTemp = (<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>)(i);
00247         <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;mpTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>))!=0 )
00248             testFailed = <span class="keyword">true</span>;
00249         offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00250    }
00251    usTemp = 0xFFFF;
00252    <span class="keywordflow">if</span> ( memcmp(packet+offset,&amp;usTemp,2)!=0 )
00253        testFailed = <span class="keyword">true</span>;
00254    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00255 
00256    <span class="keywordflow">if</span> ( testFailed )
00257    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong telemetry packet content"</span>);
00258         <span class="keywordflow">return</span>;
00259    }
00260 
00261    <span class="comment">// Do non-nominal behaviour checks and check event generation</span>
00262    <span class="keywordflow">if</span> ( <a class="code" href="classTestCase.html#b1">isNonNominalCheckAllowed</a>() ) {
00263        <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvt = <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00264 
00265        <span class="comment">// Try defining a non-existent block</span>
00266        pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a7">defineBlock</a>(3,pa+osa,lena);       
00267        <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+1,EVT_PUS_ILLEGAL_BLOCK_INDEX) )
00268            <span class="keywordflow">return</span>;
00269 
00270        <span class="comment">// Try loading too many blocks</span>
00271        pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a3">setNumberBlocks</a>(5);
00272        <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+2,EVT_PUS_TOO_MANY_DUMP_BLOCKS) )
00273            <span class="keywordflow">return</span>;
00274 
00275        <span class="comment">// Try dumping more memory locations than fit in the dump buffer</span>
00276        pMD-&gt;<a class="code" href="classPUSMemoryDump.html#a7">defineBlock</a>(0,pa+osb,maxNumberData+1);    
00277        pMD-&gt;<a class="code" href="classDC__PUSMemoryDumpOffset.html#a3">update</a>();
00278        <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+3,EVT_PUS_TOO_MANY_MEM_DATA) )
00279            <span class="keywordflow">return</span>;
00280    }
00281 
00282    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00283    <span class="keywordflow">return</span>;
00284 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
