<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCasePUSDataReportingPacket_2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCasePUSDataReportingPacket_2.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCasePUSDataReportingPacket_2.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         04.12.03</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../Telemetry/DC_PUSDataReportingPacket.h"</span>
00015 <span class="preprocessor">#include "../Data/DC_SampleFullDataPool.h"</span>
00016 <span class="preprocessor">#include "../Utilities/TestCaseWithEvtCheck.h"</span>
00017 <span class="preprocessor">#include "TestCasePUSDataReportingPacket_2.h"</span>
00018 
00019 <span class="preprocessor">#include &lt;math.h&gt;</span>
00020 <span class="preprocessor">#include &lt;float.h&gt;</span>
00021 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00022 <span class="preprocessor">#include &lt;string.h&gt;</span>
00023 
<a name="l00024"></a><a class="code" href="classTestCasePUSDataReportingPacket__2.html#a0">00024</a> <a class="code" href="classTestCasePUSDataReportingPacket__2.html#a0">TestCasePUSDataReportingPacket_2::TestCasePUSDataReportingPacket_2</a>(<span class="keywordtype">void</span>) :
00025         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_PUSDATAREPORTINGPACKET*10+2,"<a class="code" href="classTestCasePUSDataReportingPacket__2.html">TestCasePUSDataReportingPacket_2</a>") {
00026                 <span class="keywordflow">return</span>;
00027 }
00028 
<a name="l00029"></a><a class="code" href="classTestCasePUSDataReportingPacket__2.html#a1">00029</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSDataReportingPacket__2.html#a1">TestCasePUSDataReportingPacket_2::runTestCase</a>(<span class="keywordtype">void</span>) {
00030 
00031    <a class="code" href="classDC__SampleFullDataPool.html">DC_SampleFullDataPool</a>* pDP = <span class="keyword">new</span> <a class="code" href="classDC__SampleFullDataPool.html">DC_SampleFullDataPool</a>();
00032    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvt = <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00033    <a class="code" href="classDC__PUSDataReportingPacket.html">DC_PUSDataReportingPacket</a>* pTMP = <span class="keyword">new</span> <a class="code" href="classDC__PUSDataReportingPacket.html">DC_PUSDataReportingPacket</a>();
00034 
00035    <span class="comment">// Configure and load the data pool</span>
00036    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a1">setObsClock</a>(DC_PUSDataReportingPacket::getObsClock());
00037    <a class="code" href="classDataPool.html">DataPool</a>* pOldDP = <a class="code" href="classCC__RootObject.html#e8">CC_RootObject::getDataPool</a>();
00038    CC_RootObject::setDataPool(pDP);
00039 
00040    <span class="comment">// Define the PUS packet</span>
00041    <a class="code" href="BasicTypes_8h.html#a21">TD_SID</a> sid = 12;
00042    <a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a> collectionInterval = 6;
00043    <a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a> NPAR1 = 0;
00044    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> NFA = 1;
00045    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> NREP2 = 2;
00046    <a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a> NPAR2 = 2;
00047    <a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a> par1 = 1;
00048    <a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a> val1 = 11;
00049    <a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a> par2 = 2;
00050    <a class="code" href="BasicTypes_8h.html#a17">TD_Float</a> val2 = 12.0;
00051 
00052    <span class="comment">// Construct the packet</span>
00053    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> defPacketSize = 50;
00054    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* packet = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[defPacketSize];
00055    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset = 0;
00056    memcpy(packet+offset,&amp;sid,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>));
00057    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00058    memcpy(packet+offset,&amp;collectionInterval,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>));
00059    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>);
00060    memcpy(packet+offset,&amp;NPAR1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>));
00061    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>);
00062    memcpy(packet+offset,&amp;NFA,1);
00063    offset += 1;
00064    memcpy(packet+offset,&amp;NREP2,1);
00065    offset += 1;
00066    memcpy(packet+offset,&amp;NPAR2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>));
00067    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>);
00068    memcpy(packet+offset,&amp;par1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>));
00069    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>);
00070    memcpy(packet+offset,&amp;par2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>));
00071    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>);
00072 
00073    assert(offset&lt;defPacketSize);
00074 
00075    <span class="comment">// Configure the data reporting packet and check configuration status</span>
00076    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a18">setMaxNumberFA</a>(1);
00077    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a16">setDefinitionBufferSize</a>(defPacketSize);
00078    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> valBufferSize = 100;
00079    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a20">setValueBufferSize</a>(valBufferSize);
00080    pTMP-&gt;<a class="code" href="classPUSTelemetryPacket.html#a2">setSubType</a>(<a class="code" href="Constants_8h.html#a70">PUS_ST_DATA_REP_PAR_HK_REP</a>);
00081    pTMP-&gt;<a class="code" href="classPUSTelemetryPacket.html#a7">setTimeTag</a>(0);
00082    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a1">setEnabled</a>(<a class="code" href="Constants_8h.html#a3">ENABLED</a>);
00083    <span class="keywordflow">if</span> ( !pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a22">isObjectConfigured</a>() )
00084    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration status"</span>);
00085         <span class="keywordflow">return</span>;
00086    }
00087 
00088    <span class="comment">// Load the packet definition</span>
00089    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i=0; i&lt;offset; i++)
00090         pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a7">setDefinitionBuffer</a>(i,packet[i]);
00091 
00092    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a9">getDefinitionBufferLength</a>()!=offset)
00093    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong definition buffer length"</span>);
00094         <span class="keywordflow">return</span>;
00095    }
00096 
00097    <span class="comment">// Set the values of the data pool items</span>
00098    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par1,val1);
00099    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par2,val2);
00100 
00101    <span class="comment">// Send three update requests and check that there are no data to be acquired</span>
00102    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00103    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=0)
00104    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00105         <span class="keywordflow">return</span>;
00106    }
00107    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00108    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=0)
00109    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00110         <span class="keywordflow">return</span>;
00111    }
00112    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00113    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=0)
00114    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00115         <span class="keywordflow">return</span>;
00116    }
00117 
00118    <span class="comment">// Update the values of the data pool items</span>
00119    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par1,(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)(2*val1));
00120    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par2,(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)(2*val2));
00121 
00122    <span class="comment">// Send two update requests and check that there are no data to be acquired</span>
00123    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00124    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=0)
00125    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00126         <span class="keywordflow">return</span>;
00127    }
00128    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00129    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=0)
00130    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00131         <span class="keywordflow">return</span>;
00132    }
00133 
00134    <span class="comment">// Send an update request and check data acquisition service</span>
00135    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00136    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> n1, n2, n3;
00137    n1 = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00138    n2 = (<a class="code" href="Constants_8h.html#a34">PUS_DATA_REP_MODE</a>?1:0);
00139    n3 = 2*(<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>));
00140    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> expNumberOfBytes = n1+n2+n3;
00141    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=expNumberOfBytes)
00142    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00143         <span class="keywordflow">return</span>;
00144    }
00145 
00146    <span class="comment">// Collect the packet data and check their values</span>
00147    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>* valBuffer = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[valBufferSize];
00148    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>(); i++)
00149        valBuffer[i] = pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a13">getUnsignedByte</a>(i);
00150 
00151    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> valOffset = 0;
00152    <a class="code" href="BasicTypes_8h.html#a21">TD_SID</a> sidTemp = 0;
00153    <a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a> intTemp = 0;
00154    <a class="code" href="BasicTypes_8h.html#a17">TD_Float</a> flTemp = 0;
00155 
00156    memcpy(&amp;sidTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>));
00157    <span class="keywordflow">if</span> ( sidTemp != sid )
00158    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong sid field"</span>);
00159         <span class="keywordflow">return</span>;
00160    }
00161    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00162 
00163    <span class="keywordflow">if</span> ( <a class="code" href="Constants_8h.html#a34">PUS_DATA_REP_MODE</a>?valBuffer[valOffset]!=0:<span class="keyword">false</span> )
00164    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong mode field"</span>);
00165         <span class="keywordflow">return</span>;
00166    }
00167    valOffset += (<a class="code" href="Constants_8h.html#a34">PUS_DATA_REP_MODE</a>?1:0);
00168 
00169    memcpy(&amp;intTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>));
00170    <span class="keywordflow">if</span> ( intTemp != (<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)val1 )
00171    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 1 field"</span>);
00172         <span class="keywordflow">return</span>;
00173    }
00174    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>);
00175 
00176    memcpy(&amp;flTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>));
00177    <span class="keywordflow">if</span> ( fabs((<span class="keywordtype">float</span>)(flTemp - (<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)val2)) &gt; FLT_EPSILON )
00178    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 2 field"</span>);
00179         <span class="keywordflow">return</span>;
00180    }
00181    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>);
00182 
00183    memcpy(&amp;intTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>));
00184    <span class="keywordflow">if</span> ( intTemp != (<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)2*val1 )
00185    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 1 field"</span>);
00186         <span class="keywordflow">return</span>;
00187    }
00188    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>);
00189 
00190    memcpy(&amp;flTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>));
00191    <span class="keywordflow">if</span> ( fabs((<span class="keywordtype">float</span>)(flTemp - (<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)2*val2)) &gt; FLT_EPSILON )
00192    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 2 field"</span>);
00193         <span class="keywordflow">return</span>;
00194    }
00195    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>);
00196 
00197    assert(valOffset&lt;valBufferSize);
00198 
00199    <span class="comment">// Update the values of the data pool items</span>
00200    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par1,(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)(3*val1));
00201    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par2,(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)(3*val2));
00202 
00203    <span class="comment">// Send six update requests and check data acquisition service</span>
00204    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00205    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00206    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00207    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par1,(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)(4*val1));
00208    pDP-&gt;<a class="code" href="classDC__SampleFullDataPool.html#a3">setValue</a>(par2,(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)(4*val2));
00209    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00210    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00211    pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a10">update</a>();
00212 
00213    n1 = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00214    n2 = (<a class="code" href="Constants_8h.html#a34">PUS_DATA_REP_MODE</a>?1:0);
00215    n3 = 2*(<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>));
00216    expNumberOfBytes = n1+n2+n3;
00217    <span class="keywordflow">if</span> (pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>()!=expNumberOfBytes)
00218    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of bytes"</span>);
00219         <span class="keywordflow">return</span>;
00220    }
00221 
00222    <span class="comment">// Collect the packet data and check their values</span>
00223    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a12">getNumberOfBytes</a>(); i++)
00224        valBuffer[i] = pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a13">getUnsignedByte</a>(i);
00225 
00226    valOffset = 0;
00227    memcpy(&amp;sidTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>));
00228    <span class="keywordflow">if</span> ( sidTemp != sid )
00229    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong sid field"</span>);
00230         <span class="keywordflow">return</span>;
00231    }
00232    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00233 
00234    <span class="keywordflow">if</span> ( <a class="code" href="Constants_8h.html#a34">PUS_DATA_REP_MODE</a>?valBuffer[valOffset]!=0:<span class="keyword">false</span> )
00235    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong mode field"</span>);
00236         <span class="keywordflow">return</span>;
00237    }
00238    valOffset += (<a class="code" href="Constants_8h.html#a34">PUS_DATA_REP_MODE</a>?1:0);
00239 
00240    memcpy(&amp;intTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>));
00241    <span class="keywordflow">if</span> ( intTemp != (<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)3*val1 )
00242    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 1 field"</span>);
00243         <span class="keywordflow">return</span>;
00244    }
00245    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>);
00246 
00247    memcpy(&amp;flTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>));
00248    <span class="keywordflow">if</span> ( fabs((<span class="keywordtype">float</span>)(flTemp - (<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)3*val2)) &gt; FLT_EPSILON )
00249    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 2 field"</span>);
00250         <span class="keywordflow">return</span>;
00251    }
00252    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>);
00253 
00254    memcpy(&amp;intTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>));
00255    <span class="keywordflow">if</span> ( intTemp != (<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>)4*val1 )
00256    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 1 field"</span>);
00257         <span class="keywordflow">return</span>;
00258    }
00259    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a18">TD_Integer</a>);
00260 
00261    memcpy(&amp;flTemp,valBuffer+valOffset,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>));
00262    <span class="keywordflow">if</span> ( fabs((<span class="keywordtype">float</span>)(flTemp - (<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>)4*val2)) &gt; FLT_EPSILON )
00263    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong parameter 2 field"</span>);
00264         <span class="keywordflow">return</span>;
00265    }
00266    valOffset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a17">TD_Float</a>);
00267 
00268    assert(valOffset&lt;valBufferSize);
00269 
00270    <span class="comment">// Define a new PUS packet with two FA arrays of one parameter each</span>
00271    sid = 12;
00272    collectionInterval = 3;
00273    NPAR1 = 0;
00274    NFA = 2;
00275    NREP2 = 2;
00276    NPAR2 = 1;
00277    par1 = 1;
00278    val1 = 11;
00279    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> NREP3 = 3;
00280    <a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a> NPAR3 = 1;
00281    par2 = 2;
00282    val2 = 12.0;
00283 
00284    <span class="comment">// Construct the packet</span>
00285    defPacketSize = 50;
00286    packet = <span class="keyword">new</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>[defPacketSize];
00287    offset = 0;
00288    memcpy(packet+offset,&amp;sid,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>));
00289    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00290    memcpy(packet+offset,&amp;collectionInterval,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>));
00291    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>);
00292    memcpy(packet+offset,&amp;NPAR1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>));
00293    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>);
00294    memcpy(packet+offset,&amp;NFA,1);
00295    offset += 1;
00296    memcpy(packet+offset,&amp;NREP2,1);
00297    offset += 1;
00298    memcpy(packet+offset,&amp;NPAR2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>));
00299    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>);
00300    memcpy(packet+offset,&amp;par1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>));
00301    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>);
00302    memcpy(packet+offset,&amp;NREP3,1);
00303    offset += 1;
00304    memcpy(packet+offset,&amp;NPAR3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>));
00305    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>);
00306    memcpy(packet+offset,&amp;par2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>));
00307    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>);
00308 
00309    assert(offset&lt;defPacketSize);
00310 
00311    <span class="comment">// Load the packet definition</span>
00312    <span class="keywordflow">if</span> (<a class="code" href="classTestCase.html#b1">isNonNominalCheckAllowed</a>()) {
00313        <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> i=0; i&lt;offset; i++)
00314            pTMP-&gt;<a class="code" href="classDC__PUSDataReportingPacket.html#a7">setDefinitionBuffer</a>(i,packet[i]);
00315        nEvt = this-&gt;<a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00316        <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt,EVT_ILLEGAL_PUS_REP_PACKET) )
00317             <span class="keywordflow">return</span>;
00318    }
00319 
00320    <span class="comment">// Restore the original data pool</span>
00321    CC_RootObject::setDataPool(pOldDP);
00322 
00323    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00324    <span class="keywordflow">return</span>;
00325 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
