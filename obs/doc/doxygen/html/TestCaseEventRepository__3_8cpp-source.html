<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseEventRepository_3.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseEventRepository_3.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseEventRepository_3.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.1</span>
00007 <span class="comment">// Date         25.02.03</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "TestCaseEventRepository_3.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00015 <span class="preprocessor">#include "../System/DC_DummyObsClock.h"</span>
00016 <span class="preprocessor">#include "../Event/DC_EventRepository.h"</span>
00017 <span class="preprocessor">#include "../Event/DC_Event.h"</span>
00018 
<a name="l00019"></a><a class="code" href="classTestCaseEventRepository__3.html#a0">00019</a> <a class="code" href="classTestCaseEventRepository__3.html#a0">TestCaseEventRepository_3::TestCaseEventRepository_3</a>(<span class="keywordtype">void</span>) :
00020         <a class="code" href="classTestCaseGenericSetUp.html">TestCaseGenericSetUp</a>(ID_EVENTREPOSITORY*10+3,"<a class="code" href="classTestCaseEventRepository__3.html">TestCaseEventRepository_3</a>") {
00021                 <span class="keywordflow">return</span>;
00022 }
00023 
<a name="l00024"></a><a class="code" href="classTestCaseEventRepository__3.html#a1">00024</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseEventRepository__3.html#a1">TestCaseEventRepository_3::runTestCase</a>(<span class="keywordtype">void</span>) {
00025 
00026    <a class="code" href="classDC__EventRepository.html">DC_EventRepository</a>* pRep = <span class="keyword">new</span> <a class="code" href="classDC__EventRepository.html">DC_EventRepository</a>();
00027 
00028    <a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a> type1 = (<a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a>)0x0001;
00029    <a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a> type2 = (<a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a>)0x0002;
00030    <a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a> type3 = (<a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a>)0x0010;
00031 
00032    <span class="comment">// Configure the event repository: load OBS clock and set repository size</span>
00033    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> size = 4;
00034    <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>* pClk = <span class="keyword">new</span> <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>();
00035    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a14">setObsClock</a>(pClk);
00036    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a1">setRepositorySize</a>(size);
00037 
00038    <span class="comment">// Check correct configuration</span>
00039    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a17">isObjectConfigured</a>() == <a class="code" href="Constants_8h.html#a1">NOT_CONFIGURED</a>) )
00040         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00041            <span class="stringliteral">"Wrong event repository configuration status after configuration"</span>);
00042            <span class="keywordflow">return</span>;
00043         }
00044 
00045    <span class="comment">// Fill up the repository with a few events</span>
00046    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type1);
00047    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type2);
00048    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type3);
00049    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type1);
00050    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type2);
00051 
00052    <span class="comment">// Disable repository and check correctness</span>
00053    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a3">setEnabled</a>(<a class="code" href="Constants_8h.html#a2">DISABLED</a>);
00054    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a5">isEnabled</a>()) )
00055         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong enable status"</span>);
00056                 <span class="keywordflow">return</span>;
00057         }
00058 
00059    <span class="comment">// Retrieve status of the repository</span>
00060    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> counter = pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>();
00061    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00062    <a class="code" href="BasicTypes_8h.html#a33">TD_EventType</a> type = pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>();
00063 
00064    <span class="comment">// Attempt to create event and check that nothing happens</span>
00065    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type1);
00066    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != counter) )
00067         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Event created in disabled repository"</span>);
00068                 <span class="keywordflow">return</span>;
00069         }
00070    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00071    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != type )
00072         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00073              <span class="stringliteral">"Event created in disabled repository"</span>);
00074                 <span class="keywordflow">return</span>;
00075         }
00076 
00077    <span class="comment">// Enable repositoy and check that events can now be created</span>
00078    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a3">setEnabled</a>(<a class="code" href="Constants_8h.html#a3">ENABLED</a>);
00079    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type3);
00080    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != counter+1) )
00081         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Failure to create event in enabled repository"</span>);
00082                 <span class="keywordflow">return</span>;
00083         }
00084    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00085    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != type3 )
00086         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00087              <span class="stringliteral">"Failure to create event in enabled repository"</span>);
00088                 <span class="keywordflow">return</span>;
00089         }
00090 
00091    <span class="comment">// Set event repository mask and check that the correct mask is loaded</span>
00092     pRep-&gt;<a class="code" href="classDC__EventRepository.html#a3">setEnabled</a>(type2,<a class="code" href="Constants_8h.html#a2">DISABLED</a>);
00093     <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a5">isEnabled</a>(type2) )
00094         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00095              <span class="stringliteral">"Error in setting event repository mask"</span>);
00096                 <span class="keywordflow">return</span>;
00097         }
00098 
00099    <span class="comment">// Check that creation of masked event is disabled</span>
00100    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type2);
00101    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != counter+1) )
00102         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Failure to selectively disabled event creation"</span>);
00103                 <span class="keywordflow">return</span>;
00104         }
00105 
00106    <span class="comment">// Check that creation of unmasked events is still ensabled</span>
00107    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a2">create</a>(pRep,type3);
00108    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != counter+2) )
00109         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Failure to selectively enabled event creation"</span>);
00110                 <span class="keywordflow">return</span>;
00111         }
00112 
00113         setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00114         <span class="keywordflow">return</span>;
00115 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
