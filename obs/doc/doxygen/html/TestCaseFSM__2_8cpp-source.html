<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseFSM_2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseFSM_2.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseFSM_2.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.1</span>
00007 <span class="comment">// Date         04.04.03</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "TestCaseFSM_2.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00014 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00015 <span class="preprocessor">#include "../FSM/CC_FSM.h"</span>
00016 <span class="preprocessor">#include "../FSM/DC_DummyFsmState.h"</span>
00017 <span class="preprocessor">#include "../FSM/DC_FsmEvent.h"</span>
00018 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00019 <span class="preprocessor">#include "../Event/DC_EventRepository.h"</span>
00020 
<a name="l00021"></a><a class="code" href="classTestCaseFSM__2.html#a0">00021</a> <a class="code" href="classTestCaseFSM__2.html#a0">TestCaseFSM_2::TestCaseFSM_2</a>(<span class="keywordtype">void</span>) :
00022         <a class="code" href="classTestCaseGenericSetUp.html">TestCaseGenericSetUp</a>(ID_FSM*10+2,"<a class="code" href="classTestCaseFSM__2.html">TestCaseFSM_2</a>") {
00023                 <span class="keywordflow">return</span>;
00024 }
00025 
<a name="l00026"></a><a class="code" href="classTestCaseFSM__2.html#a1">00026</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseFSM__2.html#a1">TestCaseFSM_2::runTestCase</a>(<span class="keywordtype">void</span>) {
00027 
00028    <a class="code" href="classCC__FSM.html">CC_FSM</a>* pFsm = <span class="keyword">new</span> <a class="code" href="classCC__FSM.html">CC_FSM</a>();
00029 
00030    <span class="comment">// Configure the FSM</span>
00031    pFsm-&gt;<a class="code" href="classCC__FSM.html#a3">setNumberOfStates</a>(4);
00032 
00033    <a class="code" href="classDC__DummyFsmState.html">DC_DummyFsmState</a>* pState[4];
00034    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a6">TD_FsmStateIndex</a> i=0; i&lt;pFsm-&gt;<a class="code" href="classCC__FSM.html#a4">getNumberOfStates</a>(); i++)
00035       pState[i] = <span class="keyword">new</span> <a class="code" href="classDC__DummyFsmState.html">DC_DummyFsmState</a>();
00036 
00037    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a6">TD_FsmStateIndex</a> i=0; i&lt;pFsm-&gt;<a class="code" href="classCC__FSM.html#a4">getNumberOfStates</a>(); i++)
00038       pFsm-&gt;<a class="code" href="classCC__FSM.html#a5">setState</a>(i,pState[i]);
00039 
00040    pFsm-&gt;<a class="code" href="classCC__FSM.html#a1">reset</a>();
00041 
00042    <span class="comment">// FSM object should now be configured</span>
00043    <span class="keywordflow">if</span> ( (pFsm-&gt;<a class="code" href="classCC__FSM.html#a2">isObjectConfigured</a>() == <a class="code" href="Constants_8h.html#a1">NOT_CONFIGURED</a>) )
00044         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00045              <span class="stringliteral">"Wrong FSM configuration status after configuration was completed"</span>);
00046                 <span class="keywordflow">return</span>;
00047         }
00048 
00049    <span class="comment">// Create and configure the FsmEvents</span>
00050    <a class="code" href="classDC__FsmEvent.html">DC_FsmEvent</a>* pFsmEvt_1 = <span class="keyword">new</span> <a class="code" href="classDC__FsmEvent.html">DC_FsmEvent</a>();
00051    DC_FsmEvent* pFsmEvt_2 = <span class="keyword">new</span> DC_FsmEvent();
00052    DC_FsmEvent* pFsmEvt_3 = <span class="keyword">new</span> DC_FsmEvent();
00053    pFsmEvt_1-&gt;<a class="code" href="classDC__FsmEvent.html#a1">setTargetFsm</a>(pFsm);
00054    pFsmEvt_2-&gt;<a class="code" href="classDC__FsmEvent.html#a1">setTargetFsm</a>(pFsm);
00055    pFsmEvt_3-&gt;<a class="code" href="classDC__FsmEvent.html#a1">setTargetFsm</a>(pFsm);
00056    pFsmEvt_1-&gt;<a class="code" href="classDC__FsmEvent.html#a2">setTargetState</a>(1);
00057    pFsmEvt_2-&gt;<a class="code" href="classDC__FsmEvent.html#a2">setTargetState</a>(2);
00058    pFsmEvt_3-&gt;<a class="code" href="classDC__FsmEvent.html#a2">setTargetState</a>(0);
00059 
00060    <span class="comment">// Activate FSM twice (just to exercise the FSM)</span>
00061    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00062    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00063 
00064    <span class="comment">// Fire FsmEvent 1 and check transition</span>
00065    pFsmEvt_1-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>();
00066    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 0)
00067         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00068              <span class="stringliteral">"No state transition should have occurred"</span>);
00069                 <span class="keywordflow">return</span>;
00070         }
00071    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00072    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00073         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00074              <span class="stringliteral">"Wrong state after FsmEvt_1 firing"</span>);
00075                 <span class="keywordflow">return</span>;
00076         }
00077 
00078    <span class="comment">// Check that the correct event was created</span>
00079    <a class="code" href="classDC__EventRepository.html">DC_EventRepository</a>* pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00080    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00081    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_TRANSITION )
00082         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00083              <span class="stringliteral">"Wrong event after state transition"</span>);
00084                 <span class="keywordflow">return</span>;
00085         }
00086 
00087    <span class="comment">// Activate FSM twice and check that no state transition takes place</span>
00088    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00089    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00090    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00091         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00092              <span class="stringliteral">"Wrong state after activation of FSM"</span>);
00093                 <span class="keywordflow">return</span>;
00094         }
00095 
00096    <span class="comment">// Fire events 2 and 3 and check that only second firing has an effect</span>
00097    pFsmEvt_2-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>();
00098    pFsmEvt_3-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>();
00099    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00100    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 0)
00101         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00102              <span class="stringliteral">"Wrong state after FsmEvt_2 and FsmEvt_3 firing"</span>);
00103                 <span class="keywordflow">return</span>;
00104         }
00105 
00106    <span class="comment">// Activate FSM twice (just to exercise state 0)</span>
00107    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00108    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00109 
00110    <span class="comment">// Disable transitions into state 2, fire FsmEvt_2 and check that</span>
00111    <span class="comment">// no transition takes place</span>
00112    pFsm-&gt;<a class="code" href="classCC__FSM.html#a8">setTransitionEnableStatus</a>(2,<a class="code" href="Constants_8h.html#a2">DISABLED</a>);
00113    pFsmEvt_2-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>();
00114    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00115    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 0)
00116         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00117              <span class="stringliteral">"Wrong state after FsmEvt_2 firing"</span>);
00118                 <span class="keywordflow">return</span>;
00119         }
00120 
00121    <span class="comment">// Check that the correct event was created</span>
00122    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00123    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_TRANSITION_DISABLED )
00124         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00125              <span class="stringliteral">"Wrong event after state transition"</span>);
00126                 <span class="keywordflow">return</span>;
00127         }
00128 
00129     <span class="comment">// Attempt to disable transition into non-existent state</span>
00130     <span class="keywordflow">if</span> (<a class="code" href="classTestCase.html#b1">isNonNominalCheckAllowed</a>()) {
00131         pFsm-&gt;<a class="code" href="classCC__FSM.html#a8">setTransitionEnableStatus</a>(4,<a class="code" href="Constants_8h.html#a2">DISABLED</a>);
00132         pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00133         <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_ILLEGAL_FS )
00134             {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00135                 <span class="stringliteral">"Failure of non-nominal behaviour check"</span>);
00136                     <span class="keywordflow">return</span>;
00137             }
00138     }
00139 
00140     setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00141         <span class="keywordflow">return</span>;
00142 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
