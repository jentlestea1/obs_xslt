<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseTelecommandManager_3.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseTelecommandManager_3.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseTelecommandManager_3.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.1</span>
00007 <span class="comment">// Date         11.04.03</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/TestConstants.h"</span>
00013 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00014 <span class="preprocessor">#include "../Event/DC_EventRepository.h"</span>
00015 <span class="preprocessor">#include "../Telecommand/DC_DummyTelecommandLoader.h"</span>
00016 <span class="preprocessor">#include "../Telecommand/CC_TelecommandManager.h"</span>
00017 <span class="preprocessor">#include "../System/DC_DummyObsClock.h"</span>
00018 <span class="preprocessor">#include "../Telecommand/TelecommandLoader.h"</span>
00019 <span class="preprocessor">#include "../Telecommand/DC_DummyTelecommand.h"</span>
00020 <span class="preprocessor">#include "TestCaseTelecommandManager_3.h"</span>
00021 
<a name="l00022"></a><a class="code" href="classTestCaseTelecommandManager__3.html#a0">00022</a> <a class="code" href="classTestCaseTelecommandManager__3.html#a0">TestCaseTelecommandManager_3::TestCaseTelecommandManager_3</a>(<span class="keywordtype">void</span>) :
00023         <a class="code" href="classTestCaseGenericSetUp.html">TestCaseGenericSetUp</a>(ID_TELECOMMANDMANAGER*10+3,"<a class="code" href="classTestCaseTelecommandManager__3.html">TestCaseTelecommandManager_3</a>") {
00024                 <span class="keywordflow">return</span>;
00025 }
00026 
<a name="l00027"></a><a class="code" href="classTestCaseTelecommandManager__3.html#a1">00027</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseTelecommandManager__3.html#a1">TestCaseTelecommandManager_3::runTestCase</a>(<span class="keywordtype">void</span>) {
00028 
00029    <span class="comment">// Retrieve the event repository</span>
00030    <a class="code" href="classDC__EventRepository.html">DC_EventRepository</a>* pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00031 
00032    <span class="comment">// Create the telecommand manager</span>
00033    <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>* pTcm = <span class="keyword">new</span> <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>();
00034 
00035    <span class="comment">// Define the identifiers and time tags for the dummy telecommands</span>
00036    <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tcTt1 = 0;
00037    <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tcTt2 = 0;
00038    <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tcTt3 = 0;
00039    <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId1 = 1;
00040    <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId2 = 2;
00041    <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId3 = 3;
00042 
00043    <span class="comment">// Create and load an OBS clock</span>
00044    <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>* pClk = <span class="keyword">new</span> <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>();
00045    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a5">setTime</a>(tcTt1+1);
00046    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a6">setCycle</a>(0);
00047    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a11">setObsClock</a>(pClk);
00048 
00049    <span class="comment">// Create and configure the dummy telecommands</span>
00050    <a class="code" href="classDC__DummyTelecommand.html">DC_DummyTelecommand</a>* pTc1 = <span class="keyword">new</span> <a class="code" href="classDC__DummyTelecommand.html">DC_DummyTelecommand</a>();
00051    DC_DummyTelecommand* pTc2 = <span class="keyword">new</span> DC_DummyTelecommand();
00052    DC_DummyTelecommand* pTc3 = <span class="keyword">new</span> DC_DummyTelecommand();
00053    pTc1-&gt;<a class="code" href="classTelecommand.html#a6">setTelecommandId</a>(tcId1);
00054    pTc2-&gt;<a class="code" href="classTelecommand.html#a6">setTelecommandId</a>(tcId2);
00055    pTc3-&gt;<a class="code" href="classTelecommand.html#a6">setTelecommandId</a>(tcId3);
00056    pTc1-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(tcTt1);
00057    pTc2-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(tcTt2);
00058    pTc3-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(tcTt3);
00059    pTc1-&gt;<a class="code" href="classDC__DummyTelecommand.html#a6">setExecutionCheckValue</a>(<a class="code" href="Constants_8h.html#a15">TC_CANNOT_EXECUTE</a>);
00060    pTc2-&gt;<a class="code" href="classDC__DummyTelecommand.html#a7">setValidityCheckValue</a>(<a class="code" href="Constants_8h.html#a4">NOT_VALID</a>);
00061 
00062    <span class="comment">// Create, configure and load a dummy telecommand loader</span>
00063    <a class="code" href="classDC__DummyTelecommandLoader.html">DC_DummyTelecommandLoader</a>* pTcl = <span class="keyword">new</span> <a class="code" href="classDC__DummyTelecommandLoader.html">DC_DummyTelecommandLoader</a>();
00064    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(0,pTc1);
00065    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(1,pTc2);
00066    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(2,pTc3);
00067    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a9">setTelecommandLoader</a>(pTcl);
00068    pTcl-&gt;<a class="code" href="classTelecommandLoader.html#a3">setTelecommandManager</a>(pTcm);
00069 
00070    <span class="comment">// Set the pending telecommand list size</span>
00071    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a2">setPendingTelecommandListSize</a>(2);
00072 
00073    <span class="comment">// Check that the telecommand manager is configured</span>
00074    <span class="keywordflow">if</span> ( !pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a14">isObjectConfigured</a>() )
00075    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong configuration status"</span>);
00076         <span class="keywordflow">return</span>;
00077    }
00078 
00079    <span class="comment">// Activate the telecommand loader twice and check that the</span>
00080    <span class="comment">// second telecommand is rejected because its validity check fails</span>
00081    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00082    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00083    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00084    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_NOT_VALID) )
00085    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00086         <span class="keywordflow">return</span>;
00087    }
00088 
00089    <span class="comment">// Replace the second telecommand in the telecommand loader,</span>
00090    <span class="comment">// activate the telecommand loader twice and check that the</span>
00091    <span class="comment">// last load attempt is rejected because the pending telecommand</span>
00092    <span class="comment">// list is full</span>
00093    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(1,pTc3);
00094    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();        <span class="comment">// load TC3 (second entry in dummy TC Loader</span>
00095    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();        <span class="comment">// load TC3 (third entry in dummy TC Loader</span>
00096    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00097    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_LIST_FULL) )
00098    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00099         <span class="keywordflow">return</span>;
00100    }
00101 
00102    <span class="comment">// Activate the telecommand manager and check that the second</span>
00103    <span class="comment">// telecommand is executed but the first</span>
00104    <span class="comment">// is not executed because its execution check fails</span>
00105    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00106    <span class="keywordflow">if</span> (pTc3-&gt;<a class="code" href="classDC__DummyTelecommand.html#a1">getExecutionCounter</a>() != 1)
00107    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Third telecommand was not executed"</span>);
00108         <span class="keywordflow">return</span>;
00109    }
00110    <span class="keywordflow">if</span> (pTc1-&gt;<a class="code" href="classDC__DummyTelecommand.html#a1">getExecutionCounter</a>() != 0)
00111    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"First telecommand was executed"</span>);
00112         <span class="keywordflow">return</span>;
00113    }
00114 
00115    <span class="comment">// Check generation of event to record telecommand unloading</span>
00116    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();      <span class="comment">// TC 3 punctual action was executed</span>
00117    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a8">previous</a>();    <span class="comment">// TC 3 was successfully executed</span>
00118    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a8">previous</a>();    <span class="comment">// TC 1 execution check failed</span>
00119    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_EXEC_CHECK_FAIL) )
00120    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00121         <span class="keywordflow">return</span>;
00122    }
00123 
00124    <span class="comment">// Check allocation counter value</span>
00125    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 0 )
00126    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00127         <span class="keywordflow">return</span>;
00128    }
00129 
00130    <span class="comment">// Activate the telecommand loader three times and verify that two</span>
00131    <span class="comment">// telecommands are loaded</span>
00132    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00133    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00134    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00135    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>()!=2 )
00136    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00137         <span class="keywordflow">return</span>;
00138    }
00139    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 2 )
00140    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00141         <span class="keywordflow">return</span>;
00142    }
00143 
00144    <span class="comment">// Reset telecommand manager and verify number of pending telecommands</span>
00145    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvt = pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>();
00146    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a1">reset</a>();
00147    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>()!=0 )
00148    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00149         <span class="keywordflow">return</span>;
00150    }
00151 
00152    <span class="comment">// Verify events generated as a result of the reset</span>
00153    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != nEvt+2)  )
00154    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of events"</span>);
00155         <span class="keywordflow">return</span>;
00156    }
00157    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00158    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_ABORTED)  )
00159    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00160         <span class="keywordflow">return</span>;
00161    }
00162    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a8">previous</a>();
00163    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_ABORTED)  )
00164    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00165         <span class="keywordflow">return</span>;
00166    }
00167 
00168    <span class="comment">// Check allocation counter value</span>
00169    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 0 )
00170    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00171         <span class="keywordflow">return</span>;
00172    }
00173 
00174    <span class="comment">// Activate the telecommand loader three times and verify that two</span>
00175    <span class="comment">// telecommands are loaded</span>
00176    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00177    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00178    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00179    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>()!=2 )
00180    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00181         <span class="keywordflow">return</span>;
00182    }
00183    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 2 )
00184    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00185         <span class="keywordflow">return</span>;
00186    }
00187 
00188    <span class="comment">// Abort the first telecommand</span>
00189    nEvt = pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>();
00190    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a7">abort</a>(pTc1-&gt;<a class="code" href="classTelecommand.html#a5">getTelecommandId</a>());
00191    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>()!=1 )
00192    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00193         <span class="keywordflow">return</span>;
00194    }
00195    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 1 )
00196    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00197         <span class="keywordflow">return</span>;
00198    }
00199 
00200    <span class="comment">// Check abort event</span>
00201    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != nEvt+1)  )
00202    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of events"</span>);
00203         <span class="keywordflow">return</span>;
00204    }
00205    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00206    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_ABORTED)  )
00207    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00208         <span class="keywordflow">return</span>;
00209    }
00210 
00211    <span class="comment">// Abort the last telecommand</span>
00212    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a7">abort</a>(pTc3);
00213    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>()!=0 )
00214    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00215         <span class="keywordflow">return</span>;
00216    }
00217    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 0 )
00218    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00219         <span class="keywordflow">return</span>;
00220    }
00221 
00222    <span class="comment">// Check abort event</span>
00223    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a12">getCounter</a>() != nEvt+2)  )
00224    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of events"</span>);
00225         <span class="keywordflow">return</span>;
00226    }
00227    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00228    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_ABORTED)  )
00229    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong event type"</span>);
00230         <span class="keywordflow">return</span>;
00231    }
00232 
00233    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00234    <span class="keywordflow">return</span>;
00235 
00236 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
