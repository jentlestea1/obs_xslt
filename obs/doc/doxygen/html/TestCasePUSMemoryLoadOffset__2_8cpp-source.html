<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCasePUSMemoryLoadOffset_2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCasePUSMemoryLoadOffset_2.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCasePUSMemoryLoadOffset_2.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         04.02.04</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../Telecommand/DC_PUSMemoryLoadOffset.h"</span>
00015 <span class="preprocessor">#include "../Utilities/TestCaseWithEvtCheck.h"</span>
00016 <span class="preprocessor">#include "TestCasePUSMemoryLoadOffset_2.h"</span>
00017 
00018 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00019 <span class="preprocessor">#include &lt;string.h&gt;</span>
00020 
<a name="l00021"></a><a class="code" href="classTestCasePUSMemoryLoadOffset__2.html#a0">00021</a> <a class="code" href="classTestCasePUSMemoryLoadOffset__2.html#a0">TestCasePUSMemoryLoadOffset_2::TestCasePUSMemoryLoadOffset_2</a>(<span class="keywordtype">void</span>) :
00022         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_PUSMEMORYLOADOFFSET*10+2,"<a class="code" href="classTestCasePUSMemoryLoadOffset__2.html">TestCasePUSMemoryLoadOffset_2</a>") {
00023                 <span class="keywordflow">return</span>;
00024 }
00025 
<a name="l00026"></a><a class="code" href="classTestCasePUSMemoryLoadOffset__2.html#a1">00026</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSMemoryLoadOffset__2.html#a1">TestCasePUSMemoryLoadOffset_2::runTestCase</a>(<span class="keywordtype">void</span>) {
00027 
00028    <a class="code" href="classDC__PUSMemoryLoadOffset.html">DC_PUSMemoryLoadOffset</a>* pML = <span class="keyword">new</span> <a class="code" href="classDC__PUSMemoryLoadOffset.html">DC_PUSMemoryLoadOffset</a>();
00029 
00030    <span class="comment">// Set dummy values for the configuration parameters defined at</span>
00031    <span class="comment">// the level of Telecommand and PUSTelecommand superclasses</span>
00032    pML-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(0);
00033    pML-&gt;<a class="code" href="classPUSTelecommand.html#a10">setSource</a>(1);
00034    pML-&gt;<a class="code" href="classPUSTelecommand.html#a4">setTelecommandId</a>(2);
00035 
00036    <span class="comment">// Memory area where telecommand data will be loaded</span>
00037    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> paSize =100;
00038    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> pa[paSize];
00039    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;paSize; i++)
00040         pa[i]=0;
00041 
00042    <span class="comment">// Data area for the telecommand packet</span>
00043    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> defPacketSize = 100;
00044    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> packet[defPacketSize];
00045 
00046    <span class="comment">// Set maximum number of blocks</span>
00047    pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a1">setMaxNumberBlocks</a>(3);
00048    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a2">getMaxNumberBlocks</a>()!=3 )
00049    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration parameter"</span>);
00050         <span class="keywordflow">return</span>;
00051    }
00052 
00053    <span class="comment">// Set maximum number of data</span>
00054    pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a4">setMaxNumberData</a>(10);
00055    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a5">getMaxNumberData</a>()!=10 )
00056    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration parameter"</span>);
00057         <span class="keywordflow">return</span>;
00058    }
00059 
00060    <span class="comment">// Check configuration status</span>
00061    <span class="keywordflow">if</span> ( !pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a9">isObjectConfigured</a>() )
00062    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration status after initialization"</span>);
00063         <span class="keywordflow">return</span>;
00064    }
00065 
00066    <span class="comment">// Define fixed part of the memory load PUS packet </span>
00067    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset = 0;
00068    <a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a> <span class="keywordtype">id</span> = 12;
00069    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>* base = pa;
00070    memcpy(packet+offset,&amp;<span class="keywordtype">id</span>,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>));
00071    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00072    memcpy(packet+offset,&amp;base,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00073    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00074 
00075    <span class="comment">// Define the load packet (one block with four data) with the valid checksum</span>
00076    <span class="comment">// The data and their checksum are taken from one of the examples</span>
00077    <span class="comment">// in the appendix 3 of the PUS</span>
00078    <a class="code" href="BasicTypes_8h.html#a29">TD_PUSMemOffset</a> os1 = 2;
00079    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> len1 = 4;
00080    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d1 = 0xAB;
00081    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d2 = 0xCD;
00082    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d3 = 0xEF;
00083    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d4 = 0x01;
00084    <a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a> nmb = 1;
00085    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> checkSum = 0x9CF8;
00086 
00087    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00088    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00089    memcpy(packet+offset,&amp;os1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00090    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00091    memcpy(packet+offset,&amp;len1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00092    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00093    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00094    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00095    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00096    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00097    memcpy(packet+offset,&amp;d3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00098    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00099    memcpy(packet+offset,&amp;d4,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00100    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00101    memcpy(packet+offset,&amp;checkSum,2);
00102    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00103 
00104    <span class="comment">// Load packet and check validity</span>
00105    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00106    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00107         <span class="keywordflow">return</span>;
00108    }
00109    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadOffset.html#a1">setRawData</a>(packet,offset);
00110    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00111    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00112         <span class="keywordflow">return</span>;
00113    }
00114 
00115    <span class="comment">// Execute TC and check correctness</span>
00116    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>()!=ACTION_SUCCESS )
00117    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong execution outcome"</span>);
00118         <span class="keywordflow">return</span>;
00119    }
00120    <span class="keywordflow">if</span> ( (pa[os1]!=d1) || (pa[os1+1]!=d2) || (pa[os1+2]!=d3) || (pa[os1+3]!=d4) )
00121    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong loaded data"</span>);
00122         <span class="keywordflow">return</span>;
00123    }
00124 
00125    <span class="comment">// Clear patch memory area</span>
00126    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;paSize; i++)
00127         pa[i]=0;
00128 
00129    <span class="comment">// Define the load packet (one block with four data) with the invalid checksum</span>
00130    <span class="comment">// The data and their checksum are taken from one of the examples</span>
00131    <span class="comment">// in the appendix 3 of the PUS</span>
00132    offset = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>)+<span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*);
00133    os1 = 2;
00134    len1 = 4;
00135    d1 = 0xAB;
00136    d2 = 0xCD;
00137    d3 = 0xEF;
00138    d4 = 0x01;
00139    nmb = 1;
00140    checkSum = 0x9CF9;
00141 
00142    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00143    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00144    memcpy(packet+offset,&amp;os1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00145    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00146    memcpy(packet+offset,&amp;len1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00147    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00148    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00149    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00150    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00151    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00152    memcpy(packet+offset,&amp;d3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00153    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00154    memcpy(packet+offset,&amp;d4,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00155    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00156    memcpy(packet+offset,&amp;checkSum,2);
00157    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00158 
00159    <span class="comment">// Load packet and check validity</span>
00160    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00161    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00162         <span class="keywordflow">return</span>;
00163    }
00164    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadOffset.html#a1">setRawData</a>(packet,offset);
00165    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00166    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00167         <span class="keywordflow">return</span>;
00168    }
00169 
00170    <span class="comment">// Execute TC and check correctness of outcome</span>
00171    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>()!=MEM_LOAD_PRE_CHECKSUM_FAILED )
00172    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong execution outcome"</span>);
00173         <span class="keywordflow">return</span>;
00174    }
00175 
00176    <span class="comment">// Check that no data were written to patch area</span>
00177    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;paSize; i++)
00178         <span class="keywordflow">if</span> (pa[i]!=0)
00179         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong loaded data"</span>);
00180                 <span class="keywordflow">return</span>;
00181         }
00182 
00183 
00184    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00185    <span class="keywordflow">return</span>;
00186 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
