<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseFSM_3.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseFSM_3.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseFSM_3.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         14.10.02</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../FSM/CC_FSM.h"</span>
00015 <span class="preprocessor">#include "../FSM/DC_DummyConfigurableFsmState.h"</span>
00016 <span class="preprocessor">#include "../FSM/DC_FsmEvent.h"</span>
00017 <span class="preprocessor">#include "../FSM/FsmState.h"</span>
00018 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00019 <span class="preprocessor">#include "../Event/DC_EventRepository.h"</span>
00020 <span class="preprocessor">#include "TestCaseFSM_3.h"</span>
00021 
<a name="l00022"></a><a class="code" href="classTestCaseFSM__3.html#a0">00022</a> <a class="code" href="classTestCaseFSM__3.html#a0">TestCaseFSM_3::TestCaseFSM_3</a>(<span class="keywordtype">void</span>) :
00023         <a class="code" href="classTestCaseGenericSetUp.html">TestCaseGenericSetUp</a>(ID_FSM*10+3,"<a class="code" href="classTestCaseFSM__3.html">TestCaseFSM_3</a>") {
00024                 <span class="keywordflow">return</span>;
00025 }
00026 
<a name="l00027"></a><a class="code" href="classTestCaseFSM__3.html#a1">00027</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseFSM__3.html#a1">TestCaseFSM_3::runTestCase</a>(<span class="keywordtype">void</span>) {
00028 
00029    <a class="code" href="classCC__FSM.html">CC_FSM</a>* pFsm = <span class="keyword">new</span> <a class="code" href="classCC__FSM.html">CC_FSM</a>();
00030 
00031    <span class="comment">// Configure the FSM</span>
00032    pFsm-&gt;<a class="code" href="classCC__FSM.html#a3">setNumberOfStates</a>(4);
00033 
00034    <a class="code" href="classDC__DummyConfigurableFsmState.html">DC_DummyConfigurableFsmState</a>* pState[4];
00035    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a6">TD_FsmStateIndex</a> i=0; i&lt;pFsm-&gt;<a class="code" href="classCC__FSM.html#a4">getNumberOfStates</a>(); i++)
00036       pState[i] = <span class="keyword">new</span> <a class="code" href="classDC__DummyConfigurableFsmState.html">DC_DummyConfigurableFsmState</a>();
00037 
00038    pState[0]-&gt;<a class="code" href="classFsmState.html#a7">setNextState</a>(pState[1]);
00039    pState[1]-&gt;<a class="code" href="classFsmState.html#a7">setNextState</a>(pState[2]);
00040    pState[2]-&gt;<a class="code" href="classFsmState.html#a7">setNextState</a>(pState[3]);
00041    pState[3]-&gt;<a class="code" href="classFsmState.html#a7">setNextState</a>(pState[0]);
00042 
00043    <span class="keywordflow">for</span> (<a class="code" href="BasicTypes_8h.html#a6">TD_FsmStateIndex</a> i=0; i&lt;pFsm-&gt;<a class="code" href="classCC__FSM.html#a4">getNumberOfStates</a>(); i++)
00044       pFsm-&gt;<a class="code" href="classCC__FSM.html#a5">setState</a>(i,pState[i]);
00045 
00046    pFsm-&gt;<a class="code" href="classCC__FSM.html#a1">reset</a>();
00047 
00048    <span class="comment">// FSM object should now be configured</span>
00049    <span class="keywordflow">if</span> ( (pFsm-&gt;<a class="code" href="classCC__FSM.html#a2">isObjectConfigured</a>() == <a class="code" href="Constants_8h.html#a1">NOT_CONFIGURED</a>) )
00050         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00051              <span class="stringliteral">"Wrong FSM configuration status after configuration was completed"</span>);
00052                 <span class="keywordflow">return</span>;
00053         }
00054 
00055    <span class="comment">// Check the correctness of the class identifier</span>
00056    <span class="keywordflow">if</span> ( (pState[0]-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>() != ID_DUMMYCONFIGURABLEFSMSTATE) )
00057         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00058         <span class="stringliteral">"Wrong class identifier for the dummy configurable FsmState class"</span>);
00059            <span class="keywordflow">return</span>;
00060         }
00061 
00062    <span class="comment">// Activate FSM twice and check that state 0 is executed</span>
00063    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00064    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00065    <span class="keywordflow">if</span> ( pState[0]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a7">getActivationCounter</a>() != 2 )
00066         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00067              <span class="stringliteral">"Wrong value of activation counter for state 0"</span>);
00068                 <span class="keywordflow">return</span>;
00069         }
00070 
00071    <span class="comment">// Verify value of initialization counter</span>
00072    <span class="keywordflow">if</span> ( pState[0]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a8">getInitializationCounter</a>() != 1 )
00073         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00074              <span class="stringliteral">"Wrong value of initialization counter for state 0"</span>);
00075                 <span class="keywordflow">return</span>;
00076         }
00077 
00078    <span class="comment">// Force and check state transition to state 1</span>
00079    pState[0]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a12">setTerminationCheckValue</a>(<span class="keyword">true</span>);
00080    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00081    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00082         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00083              <span class="stringliteral">"State transition to state 1 failed to take place"</span>);
00084                 <span class="keywordflow">return</span>;
00085         }
00086 
00087    <span class="comment">// Check that the correct event was created</span>
00088    <a class="code" href="classDC__EventRepository.html">DC_EventRepository</a>* pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00089    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00090    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_TRANSITION )
00091         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00092              <span class="stringliteral">"Wrong event after state transition"</span>);
00093                 <span class="keywordflow">return</span>;
00094         }
00095 
00096    <span class="comment">// Check exit, initialization and activation counters</span>
00097    <span class="keywordflow">if</span> ( pState[0]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a9">getExitCounter</a>() != 1 )
00098         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00099              <span class="stringliteral">"Wrong value of exit counter for state 0"</span>);
00100                 <span class="keywordflow">return</span>;
00101         }
00102    <span class="keywordflow">if</span> ( pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a8">getInitializationCounter</a>() != 1 )
00103         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00104              <span class="stringliteral">"Wrong value of initialization counter for state 1"</span>);
00105                 <span class="keywordflow">return</span>;
00106         }
00107    <span class="keywordflow">if</span> ( pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a7">getActivationCounter</a>() != 1 )
00108         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00109              <span class="stringliteral">"Wrong value of activation counter for state 1"</span>);
00110                 <span class="keywordflow">return</span>;
00111         }
00112 
00113    <span class="comment">// Disable autonomous transition by disabling exit check and verify that</span>
00114    <span class="comment">// no transition takes place</span>
00115    pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a11">setExitCheckValue</a>(<span class="keyword">false</span>);
00116    pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a12">setTerminationCheckValue</a>(<span class="keyword">true</span>);
00117    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00118    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00119         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00120              <span class="stringliteral">"Illegal state transition out of state 1 took place"</span>);
00121                 <span class="keywordflow">return</span>;
00122         }
00123 
00124    <span class="comment">// Check that the correct event was created</span>
00125    pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00126    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00127    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_EXIT_FAILED )
00128         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00129              <span class="stringliteral">"Wrong event after failure of exit check"</span>);
00130                 <span class="keywordflow">return</span>;
00131         }
00132 
00133     <span class="comment">// Check that the last FSM activation caused the execution of state 1</span>
00134    <span class="keywordflow">if</span> ( pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a7">getActivationCounter</a>() != 2 )
00135         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00136              <span class="stringliteral">"Wrong value of activation counter for state 1"</span>);
00137                 <span class="keywordflow">return</span>;
00138         }
00139 
00140    <span class="comment">// Disable autonomous transition by disabling entry check and verify that</span>
00141    <span class="comment">// no transition takes place</span>
00142    pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a11">setExitCheckValue</a>(<span class="keyword">true</span>);
00143    pState[2]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a10">setInitializationCheckValue</a>(<span class="keyword">false</span>);
00144    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00145    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00146         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00147              <span class="stringliteral">"Illegal state transition out of state 1 took place"</span>);
00148                 <span class="keywordflow">return</span>;
00149         }
00150 
00151    <span class="comment">// Check that the correct event was created</span>
00152    pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00153    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00154    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_ENTRY_FAILED )
00155         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00156              <span class="stringliteral">"Wrong event after failure of exit check"</span>);
00157                 <span class="keywordflow">return</span>;
00158         }
00159 
00160    <span class="comment">// Disable autonomous transitions by disabling FSM transitions into state 2</span>
00161    <span class="comment">// and verify that no transition takes place</span>
00162    pState[2]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a10">setInitializationCheckValue</a>(<span class="keyword">true</span>);
00163    pFsm-&gt;<a class="code" href="classCC__FSM.html#a8">setTransitionEnableStatus</a>(2, <a class="code" href="Constants_8h.html#a2">DISABLED</a>);
00164    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00165    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00166         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00167              <span class="stringliteral">"Illegal state transition out of state 1 took place"</span>);
00168                 <span class="keywordflow">return</span>;
00169         }
00170 
00171    <span class="comment">// Check that the correct event was created</span>
00172    pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00173    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00174    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_TRANSITION_DISABLED )
00175         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00176              <span class="stringliteral">"Wrong event after failure of exit check"</span>);
00177                 <span class="keywordflow">return</span>;
00178         }
00179 
00180    <span class="comment">// Disable autonomous transitions by disabling all FSM transitions</span>
00181    <span class="comment">// and verify that no transition takes place</span>
00182    pFsm-&gt;<a class="code" href="classCC__FSM.html#a8">setTransitionEnableStatus</a>(2, <a class="code" href="Constants_8h.html#a3">ENABLED</a>);
00183    pFsm-&gt;<a class="code" href="classCC__FSM.html#a8">setTransitionEnableStatus</a>(<a class="code" href="Constants_8h.html#a2">DISABLED</a>);
00184    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00185    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 1)
00186         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00187              <span class="stringliteral">"Illegal state transition out of state 1 took place"</span>);
00188                 <span class="keywordflow">return</span>;
00189         }
00190 
00191    <span class="comment">// Check that the correct event was created</span>
00192    pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00193    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00194    <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_FSM_ALL_TRANSITION_DISABLED )
00195         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00196              <span class="stringliteral">"Wrong event after failure of exit check"</span>);
00197                 <span class="keywordflow">return</span>;
00198         }
00199 
00200    <span class="comment">// Enable autonomous transitions and verify that transition takes place</span>
00201    pFsm-&gt;<a class="code" href="classCC__FSM.html#a8">setTransitionEnableStatus</a>(<a class="code" href="Constants_8h.html#a3">ENABLED</a>);
00202    pFsm-&gt;<a class="code" href="classCC__FSM.html#a13">activate</a>();
00203    <span class="keywordflow">if</span> ( pFsm-&gt;<a class="code" href="classCC__FSM.html#a7">getCurrentState</a>() != 2)
00204         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00205              <span class="stringliteral">"State transition to state 2 failed to take place"</span>);
00206                 <span class="keywordflow">return</span>;
00207         }
00208 
00209    <span class="comment">// Check exit, initialization and activation counters</span>
00210    <span class="keywordflow">if</span> ( pState[1]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a9">getExitCounter</a>() != 1 )
00211         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00212              <span class="stringliteral">"Wrong value of exit counter for state 1"</span>);
00213                 <span class="keywordflow">return</span>;
00214         }
00215    <span class="keywordflow">if</span> ( pState[2]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a8">getInitializationCounter</a>() != 1 )
00216         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00217              <span class="stringliteral">"Wrong value of initialization counter for state 2"</span>);
00218                 <span class="keywordflow">return</span>;
00219         }
00220    <span class="keywordflow">if</span> ( pState[2]-&gt;<a class="code" href="classDC__DummyConfigurableFsmState.html#a7">getActivationCounter</a>() != 1 )
00221         {       setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00222              <span class="stringliteral">"Wrong value of activation counter for state 2"</span>);
00223                 <span class="keywordflow">return</span>;
00224         }
00225 
00226     <span class="comment">// Attempt to commands transition into non-existent state</span>
00227     <span class="keywordflow">if</span> (<a class="code" href="classTestCase.html#b1">isNonNominalCheckAllowed</a>()) {
00228         pFsm-&gt;<a class="code" href="classCC__FSM.html#a12">makeTransitionRequest</a>(4);
00229         pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00230         <span class="keywordflow">if</span> ( pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_ILLEGAL_FS )
00231             {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,
00232                 <span class="stringliteral">"Failure of non-nominal behaviour check"</span>);
00233                     <span class="keywordflow">return</span>;
00234             }
00235     }
00236 
00237         setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00238         <span class="keywordflow">return</span>;
00239 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
