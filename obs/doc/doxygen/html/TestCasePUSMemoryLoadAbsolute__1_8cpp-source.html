<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCasePUSMemoryLoadAbsolute_1.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCasePUSMemoryLoadAbsolute_1.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCasePUSMemoryLoadAbsolute_1.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         04.02.04</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../Telecommand/DC_PUSMemoryLoadAbsolute.h"</span>
00015 <span class="preprocessor">#include "../Utilities/TestCaseWithEvtCheck.h"</span>
00016 <span class="preprocessor">#include "TestCasePUSMemoryLoadAbsolute_1.h"</span>
00017 
00018 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00019 <span class="preprocessor">#include &lt;string.h&gt;</span>
00020 
<a name="l00021"></a><a class="code" href="classTestCasePUSMemoryLoadAbsolute__1.html#a0">00021</a> <a class="code" href="classTestCasePUSMemoryLoadAbsolute__1.html#a0">TestCasePUSMemoryLoadAbsolute_1::TestCasePUSMemoryLoadAbsolute_1</a>(<span class="keywordtype">void</span>) :
00022         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_PUSMEMORYLOADABSOLUTE*10+1,"<a class="code" href="classTestCasePUSMemoryLoadAbsolute__1.html">TestCasePUSMemoryLoadAbsolute_1</a>") {
00023                 <span class="keywordflow">return</span>;
00024 }
00025 
<a name="l00026"></a><a class="code" href="classTestCasePUSMemoryLoadAbsolute__1.html#a1">00026</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSMemoryLoadAbsolute__1.html#a1">TestCasePUSMemoryLoadAbsolute_1::runTestCase</a>(<span class="keywordtype">void</span>) {
00027 
00028    <a class="code" href="classDC__PUSMemoryLoadAbsolute.html">DC_PUSMemoryLoadAbsolute</a>* pML = <span class="keyword">new</span> <a class="code" href="classDC__PUSMemoryLoadAbsolute.html">DC_PUSMemoryLoadAbsolute</a>();
00029 
00030    <span class="comment">// Set dummy values for the configuration parameters defined at</span>
00031    <span class="comment">// the level of Telecommand and PUSTelecommand superclasses</span>
00032    pML-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(0);
00033    pML-&gt;<a class="code" href="classPUSTelecommand.html#a10">setSource</a>(1);
00034    pML-&gt;<a class="code" href="classPUSTelecommand.html#a4">setTelecommandId</a>(2);
00035 
00036    <span class="comment">// Memory area where telecommand data will be loaded</span>
00037    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> paSize =100;
00038    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> pa[paSize];
00039    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;paSize; i++)
00040         pa[i]=0;
00041 
00042    <span class="comment">// Data area for the telecommand packet</span>
00043    <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> defPacketSize = 100;
00044    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> packet[defPacketSize];
00045 
00046    <span class="comment">// Check the correctness of the class identifier</span>
00047    <span class="keywordflow">if</span> ( (pML-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>() != ID_PUSMEMORYLOADABSOLUTE) )
00048    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong class identifier"</span>);
00049         <span class="keywordflow">return</span>;
00050    }
00051 
00052    <span class="comment">// Check configuration status</span>
00053    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a9">isObjectConfigured</a>() )
00054    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration status at initialization"</span>);
00055         <span class="keywordflow">return</span>;
00056    }
00057 
00058    <span class="comment">// Set maximum number of blocks</span>
00059    pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a1">setMaxNumberBlocks</a>(3);
00060    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a2">getMaxNumberBlocks</a>()!=3 )
00061    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration parameter"</span>);
00062         <span class="keywordflow">return</span>;
00063    }
00064 
00065    <span class="comment">// Set maximum number of data</span>
00066    pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a4">setMaxNumberData</a>(10);
00067    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a5">getMaxNumberData</a>()!=10 )
00068    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration parameter"</span>);
00069         <span class="keywordflow">return</span>;
00070    }
00071 
00072    <span class="comment">// Check configuration status</span>
00073    <span class="keywordflow">if</span> ( !pML-&gt;<a class="code" href="classPUSMemoryLoad.html#a9">isObjectConfigured</a>() )
00074    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong configuration status after initialization"</span>);
00075         <span class="keywordflow">return</span>;
00076    }
00077 
00078    <span class="comment">// Define fixed part of the memory load PUS packet </span>
00079    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> offset = 0;
00080    <a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a> <span class="keywordtype">id</span> = 12;
00081    memcpy(packet+offset,&amp;<span class="keywordtype">id</span>,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>));
00082    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00083 
00084    <span class="comment">// Define the first load packet (one block with two data)</span>
00085    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> os1 = 2;
00086    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>* sa1 = pa+os1;
00087    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> len1 = 2;
00088    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d1 = 1;
00089    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d2 = 2;
00090    <a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a> nmb = 1;
00091    <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> checkSum = 0;
00092 
00093    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00094    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00095    memcpy(packet+offset,&amp;sa1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00096    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00097    memcpy(packet+offset,&amp;len1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00098    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00099    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00100    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00101    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00102    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00103    memcpy(packet+offset,&amp;checkSum,2);
00104    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00105 
00106    <span class="comment">// Load packet and check validity</span>
00107    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00108    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00109         <span class="keywordflow">return</span>;
00110    }
00111    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadAbsolute.html#a1">setRawData</a>(packet,offset);
00112    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00113    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00114         <span class="keywordflow">return</span>;
00115    }
00116 
00117    <span class="comment">// Execute TC and check correctness</span>
00118    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>()!=ACTION_SUCCESS )
00119    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong execution outcome"</span>);
00120         <span class="keywordflow">return</span>;
00121    }
00122    <span class="keywordflow">if</span> ( (pa[os1]!=d1) || (pa[os1+1]!=d2) )
00123    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong loaded data"</span>);
00124         <span class="keywordflow">return</span>;
00125    }
00126 
00127    <span class="comment">// Define the second load packet (three blocks with three data each)</span>
00128    offset = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00129    os1 = 2;
00130    sa1 = pa+os1;
00131    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> os2 = 20;
00132    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>* sa2 = pa+os2;
00133    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> os3 = 30;
00134    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>* sa3 = pa+os3;
00135    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> len = 3;
00136    d1 = 3;
00137    d2 = 4;
00138    <a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a> d3 = 5;
00139    nmb = 3;
00140    checkSum = 0;
00141 
00142    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00143    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00144    memcpy(packet+offset,&amp;sa1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00145    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00146    memcpy(packet+offset,&amp;len,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00147    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00148    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00149    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00150    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00151    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00152    memcpy(packet+offset,&amp;d3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00153    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00154    memcpy(packet+offset,&amp;checkSum,2);
00155    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00156 
00157    d1 = d1*2;
00158    d2 = d2*2;
00159    d3 = d3*2;
00160    memcpy(packet+offset,&amp;sa2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00161    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00162    memcpy(packet+offset,&amp;len,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00163    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00164    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00165    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00166    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00167    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00168    memcpy(packet+offset,&amp;d3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00169    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00170    memcpy(packet+offset,&amp;checkSum,2);
00171    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00172 
00173    d1 = d1*3;
00174    d2 = d2*3;
00175    d3 = d3*3;
00176    memcpy(packet+offset,&amp;sa3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00177    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00178    memcpy(packet+offset,&amp;len,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00179    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00180    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00181    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00182    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00183    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00184    memcpy(packet+offset,&amp;d3,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00185    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00186    memcpy(packet+offset,&amp;checkSum,2);
00187    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00188 
00189    <span class="comment">// Load packet and check validity</span>
00190    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00191    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00192         <span class="keywordflow">return</span>;
00193    }
00194    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadAbsolute.html#a1">setRawData</a>(packet,offset);
00195    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=0 )
00196    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00197         <span class="keywordflow">return</span>;
00198    }
00199 
00200    <span class="comment">// Execute TC and check correctness</span>
00201    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPunctualAction.html#a1">execute</a>()!=ACTION_SUCCESS )
00202    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong execution outcome"</span>);
00203         <span class="keywordflow">return</span>;
00204    }
00205    <span class="keywordflow">if</span> ( (pa[os1]!=d1/6) || (pa[os1+1]!=d2/6) || (pa[os1+2]!=d3/6) )
00206    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong loaded data"</span>);
00207         <span class="keywordflow">return</span>;
00208    }
00209    <span class="keywordflow">if</span> ( (pa[os2]!=d1/3) || (pa[os2+1]!=d2/3) || (pa[os2+2]!=d3/3) )
00210    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong loaded data"</span>);
00211         <span class="keywordflow">return</span>;
00212    }
00213    <span class="keywordflow">if</span> ( (pa[os3]!=d1) || (pa[os3+1]!=d2) || (pa[os3+2]!=d3) )
00214    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong loaded data"</span>);
00215         <span class="keywordflow">return</span>;
00216    }
00217 
00218    <span class="comment">// Define the third load packet (four blocks)</span>
00219    offset = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00220    nmb = 4;
00221    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00222    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00223    offset += 10;   <span class="comment">// dummy: just to simulate presence of memory load data </span>
00224        
00225    <span class="comment">// Load packet and check validity</span>
00226    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadAbsolute.html#a1">setRawData</a>(packet,offset);
00227    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=<a class="code" href="Constants_8h.html#a37">VC_TOO_MANY_MEM_BLOCK</a> )
00228    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00229         <span class="keywordflow">return</span>;
00230    }
00231 
00232    <span class="comment">// Define the fourth load packet (one block with 2 data, one block with nine data)</span>
00233    offset = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00234    os1 = 2;
00235    sa1 = pa+os1;
00236    os2 = 10;
00237    sa2 = pa+os2;
00238    len1 = 2;
00239    <a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a> len2 = 9;
00240    nmb = 2;
00241    checkSum = 0;
00242 
00243    d1 = 0;
00244    d2 = 0;
00245    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00246    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00247    memcpy(packet+offset,&amp;sa1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00248    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00249    memcpy(packet+offset,&amp;len1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00250    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00251    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00252    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00253    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00254    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00255    memcpy(packet+offset,&amp;checkSum,2);
00256    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00257    memcpy(packet+offset,&amp;sa2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00258    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00259    memcpy(packet+offset,&amp;len2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00260    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00261 
00262    <span class="comment">// Load packet and check validity</span>
00263    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadAbsolute.html#a1">setRawData</a>(packet,offset);
00264    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=<a class="code" href="Constants_8h.html#a38">VC_TOO_MANY_MEM_DATA</a> )
00265    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00266         <span class="keywordflow">return</span>;
00267    }
00268 
00269    <span class="comment">// Load packet with invalid number of bytes and check validity</span>
00270    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadAbsolute.html#a1">setRawData</a>(packet,1);
00271    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=<a class="code" href="Constants_8h.html#a36">VC_INCONSISTENT_RAW_DATA</a> )
00272    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00273         <span class="keywordflow">return</span>;
00274    }
00275 
00276    <span class="comment">// Define the first load packet again (one block with two data)</span>
00277    offset = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a27">TD_PUSMemId</a>);
00278    os1 = 2;
00279    sa1 = pa+os1;
00280    len1 = 2;
00281    d1 = 1;
00282    d2 = 2;
00283    nmb = 1;
00284    checkSum = 0;
00285 
00286    memcpy(packet+offset,&amp;nmb,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>));
00287    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a28">TD_PUSNumberMemBlocks</a>);
00288    memcpy(packet+offset,&amp;sa1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*));
00289    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>*);
00290    memcpy(packet+offset,&amp;len1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>));
00291    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a25">TD_PUSMemLength</a>);
00292    memcpy(packet+offset,&amp;d1,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00293    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00294    memcpy(packet+offset,&amp;d2,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>));
00295    offset += <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a26">TD_PUSMemData</a>);
00296    memcpy(packet+offset,&amp;checkSum,2);
00297    offset += <span class="keyword">sizeof</span>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span>);
00298 
00299    <span class="comment">// Load packet with wrong number of bytes and check validity</span>
00300    pML-&gt;<a class="code" href="classDC__PUSMemoryLoadAbsolute.html#a1">setRawData</a>(packet,offset+1);
00301    <span class="keywordflow">if</span> ( pML-&gt;<a class="code" href="classPUSTelecommand.html#a2">getValidityCheckCode</a>()!=<a class="code" href="Constants_8h.html#a36">VC_INCONSISTENT_RAW_DATA</a> )
00302    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong validity code"</span>);
00303         <span class="keywordflow">return</span>;
00304    }
00305 
00306    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00307    <span class="keywordflow">return</span>;
00308 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
