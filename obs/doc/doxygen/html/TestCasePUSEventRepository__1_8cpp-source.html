<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCasePUSEventRepository_1.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCasePUSEventRepository_1.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCasePUSEventRepository_1.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         04.02.04</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/BasicTypes.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../System/DC_DummyObsClock.h"</span>
00015 <span class="preprocessor">#include "../Event/DC_PUSEventRepository.h"</span>
00016 <span class="preprocessor">#include "../Manoeuvre/CC_ManoeuvreFactory.h"</span>
00017 <span class="preprocessor">#include "../Manoeuvre/DC_DummyConfigurableManoeuvre.h"</span>
00018 <span class="preprocessor">#include "../Telemetry/CC_TelemetryManager.h"</span>
00019 <span class="preprocessor">#include "../Telemetry/CC_TelemetryPacketFactory.h"</span>
00020 <span class="preprocessor">#include "../Telecommand/CC_TelecommandFactory.h"</span>
00021 <span class="preprocessor">#include "../Telecommand/CC_TelecommandManager.h"</span>
00022 <span class="preprocessor">#include "../Telecommand/DC_TestPUSTelecommand.h"</span>
00023 <span class="preprocessor">#include "../Telecommand/DC_BasicPUSTcLoader.h"</span>
00024 <span class="preprocessor">#include "../Telemetry/DC_PUSTcVerificationPacket.h"</span>
00025 <span class="preprocessor">#include "../Data/DC_SampleFullDataPool.h"</span>
00026 <span class="preprocessor">#include "../Utilities/TestCasePUSFull.h"</span>
00027 <span class="preprocessor">#include "TestCasePUSEventRepository_1.h"</span>
00028 
00029 
<a name="l00030"></a><a class="code" href="classTestCasePUSEventRepository__1.html#a0">00030</a> <a class="code" href="classTestCasePUSEventRepository__1.html#a0">TestCasePUSEventRepository_1::TestCasePUSEventRepository_1</a>(<span class="keywordtype">void</span>) :
00031         <a class="code" href="classTestCasePUSFull.html">TestCasePUSFull</a>(ID_PUSEVENTREPOSITORY*10+1,"<a class="code" href="classTestCasePUSEventRepository__1.html">TestCasePUSEventRepository_1</a>") {
00032                 <span class="keywordflow">return</span>;
00033 }
00034 
<a name="l00035"></a><a class="code" href="classTestCasePUSEventRepository__1.html#a1">00035</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSEventRepository__1.html#a1">TestCasePUSEventRepository_1::runTestCase</a>(<span class="keywordtype">void</span>) {
00036 
00037     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvt;
00038     <span class="keyword">const</span> <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId_1 = 121;
00039     <span class="keyword">const</span> <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId_2 = 122;
00040 
00041     <a class="code" href="classCC__TelecommandFactory.html">CC_TelecommandFactory</a>* pTCF = <a class="code" href="classCC__TelecommandFactory.html#e0">CC_TelecommandFactory::getInstance</a>();
00042     <span class="keywordflow">if</span> ( pTCF-&gt;<a class="code" href="classCC__TelecommandFactory.html#a42">getNumberTestPUSTelecommand</a>()!=0 )
00043     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of telecommands"</span>);
00044         <span class="keywordflow">return</span>;
00045     }
00046     <span class="keywordflow">if</span> ( pTCF-&gt;<a class="code" href="classCC__TelecommandFactory.html#a43">getCapacityTestPUSTelecommand</a>()&lt;1 )
00047     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Insufficient TC factory capacity"</span>);
00048         <span class="keywordflow">return</span>;
00049     }
00050     <a class="code" href="classDC__TestPUSTelecommand.html">DC_TestPUSTelecommand</a>* pTC = pTCF-&gt;<a class="code" href="classCC__TelecommandFactory.html#a44">allocateTestPUSTelecommand</a>();
00051     pTC-&gt;<a class="code" href="classPUSTelecommand.html#a4">setTelecommandId</a>(tcId_1);
00052 
00053     <a class="code" href="classCC__ManoeuvreFactory.html">CC_ManoeuvreFactory</a>* pMF = <a class="code" href="classCC__ManoeuvreFactory.html#e0">CC_ManoeuvreFactory::getInstance</a>();
00054     <span class="keywordflow">if</span> ( pMF-&gt;<a class="code" href="classCC__ManoeuvreFactory.html#a12">getNumberTestPUSConfigurableManoeuvre</a>()!=0 )
00055     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of manoeuvres"</span>);
00056         <span class="keywordflow">return</span>;
00057     }
00058     <span class="keywordflow">if</span> ( pMF-&gt;<a class="code" href="classCC__ManoeuvreFactory.html#a13">getCapacityTestPUSConfigurableManoeuvre</a>()&lt;1 )
00059     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Insufficient manoeuvre factory capacity"</span>);
00060         <span class="keywordflow">return</span>;
00061     }
00062     <a class="code" href="classDC__TestPUSConfigurableManoeuvre.html">DC_TestPUSConfigurableManoeuvre</a>* pMan = pMF-&gt;<a class="code" href="classCC__ManoeuvreFactory.html#a14">allocateTestPUSConfigurableManoeuvre</a>();
00063     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a8">setTelecommandId</a>(tcId_2);
00064 
00065     <a class="code" href="classDC__PUSEventRepository.html">DC_PUSEventRepository</a>* pEvtRep = <a class="code" href="classTestCasePUSFull.html#a10">getEventRepository</a>();
00066 
00067     <span class="comment">// Check the correctness of the class identifier</span>
00068     <span class="keywordflow">if</span> ( (pEvtRep-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>() != ID_PUSEVENTREPOSITORY) )
00069     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong class identifier"</span>);
00070         <span class="keywordflow">return</span>;
00071     }
00072 
00073     <span class="comment">// Flush telemetry manager to make sure that there are no pending packets in the</span>
00074     <span class="comment">// immediate dispatch queu</span>
00075     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a6">getTelemetryManager</a>()-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00076 
00077     <span class="comment">// Make repeated call to the create method for telecommands and check success</span>
00078     <span class="keyword">const</span> <a class="code" href="BasicTypes_8h.html#a14">TD_CheckCode</a> VAL_CODE = 100;
00079     <span class="keyword">const</span> <a class="code" href="BasicTypes_8h.html#a14">TD_CheckCode</a> EXEC_CODE = 101;
00080     <span class="keyword">const</span> <a class="code" href="BasicTypes_8h.html#a14">TD_CheckCode</a> CONT_CODE = 102;
00081 
00082     nEvt = <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00083     pTC-&gt;<a class="code" href="classPUSTelecommand.html#a11">setAcknowledgeLevel</a>(1);            <span class="comment">// acceptance acknowledge flag is set</span>
00084     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_LOADED);
00085     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a41">PUS_ST_TC_VER_ACC_SC</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),0) )
00086     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00087         <span class="keywordflow">return</span>;
00088     }
00089     <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+1,EVT_TC_LOADED) )
00090         <span class="keywordflow">return</span>;
00091 
00092     pTC-&gt;<a class="code" href="classPUSTelecommand.html#a11">setAcknowledgeLevel</a>(0);            <span class="comment">// acceptance acknowledge flag is reset</span>
00093     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_LOADED);
00094     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a3">checkNoTmPacket</a>(pEvtRep) )
00095     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Unexpected packet"</span>);
00096         <span class="keywordflow">return</span>;
00097     }
00098 
00099     pTC-&gt;<a class="code" href="classDC__TestPUSTelecommand.html#a8">setValidityCheckCode</a>(0);
00100     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_NOT_VALID);
00101     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a42">PUS_ST_TC_VER_ACC_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EVT_TC_NOT_VALID) )
00102     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00103         <span class="keywordflow">return</span>;
00104     }
00105 
00106     pTC-&gt;<a class="code" href="classDC__TestPUSTelecommand.html#a8">setValidityCheckCode</a>(VAL_CODE);
00107     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_NOT_VALID);
00108     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a42">PUS_ST_TC_VER_ACC_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),VAL_CODE) )
00109     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00110         <span class="keywordflow">return</span>;
00111     }
00112 
00113     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_LIST_FULL);
00114     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a42">PUS_ST_TC_VER_ACC_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EVT_TC_LIST_FULL) )
00115     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00116         <span class="keywordflow">return</span>;
00117     }
00118 
00119     nEvt = <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00120     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a4">setStartAckFlag</a>(<span class="keyword">true</span>);
00121     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_STARTED);
00122     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a43">PUS_ST_TC_EXE_STR_SC</a>,tcId_2,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),0) )
00123     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00124         <span class="keywordflow">return</span>;
00125     }
00126     <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+1,EVT_MAN_STARTED) )
00127         <span class="keywordflow">return</span>;
00128 
00129     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a4">setStartAckFlag</a>(<span class="keyword">false</span>);
00130     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_STARTED);
00131     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a3">checkNoTmPacket</a>(pEvtRep) )
00132     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Unexpected packet"</span>);
00133         <span class="keywordflow">return</span>;
00134     }
00135 
00136     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_LIST_FULL);
00137     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a44">PUS_ST_TC_EXE_STR_FL</a>,tcId_2,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EVT_MAN_LIST_FULL) )
00138     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00139         <span class="keywordflow">return</span>;
00140     }
00141 
00142     pTC-&gt;<a class="code" href="classDC__TestPUSTelecommand.html#a9">setExecutionCheckCode</a>(0);
00143     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_EXEC_CHECK_FAIL);
00144     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a44">PUS_ST_TC_EXE_STR_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EVT_TC_EXEC_CHECK_FAIL) )
00145     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00146         <span class="keywordflow">return</span>;
00147     }
00148 
00149     pTC-&gt;<a class="code" href="classDC__TestPUSTelecommand.html#a9">setExecutionCheckCode</a>(EXEC_CODE);
00150     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_EXEC_CHECK_FAIL);
00151     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a44">PUS_ST_TC_EXE_STR_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EXEC_CODE) )
00152     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00153         <span class="keywordflow">return</span>;
00154     }
00155 
00156     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_ABORTED);
00157     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a44">PUS_ST_TC_EXE_STR_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EVT_TC_ABORTED) )
00158     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00159         <span class="keywordflow">return</span>;
00160     }
00161 
00162     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a6">setProgressAckFlag</a>(<span class="keyword">true</span>);
00163     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_PROGRESS);
00164     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a45">PUS_ST_TC_EXE_PRO_SC</a>,tcId_2,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),0) )
00165     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00166         <span class="keywordflow">return</span>;
00167     }
00168 
00169     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a6">setProgressAckFlag</a>(<span class="keyword">false</span>);
00170     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_PROGRESS);
00171     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a3">checkNoTmPacket</a>(pEvtRep) )
00172     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Unexpected packet"</span>);
00173         <span class="keywordflow">return</span>;
00174     }
00175 
00176     pTC-&gt;<a class="code" href="classPUSTelecommand.html#a11">setAcknowledgeLevel</a>(8);        <span class="comment">// set completion acknowledge flag</span>
00177     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_EXEC_SUCC);
00178     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a47">PUS_ST_TC_EXE_END_SC</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),0) )
00179     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00180         <span class="keywordflow">return</span>;
00181     }
00182 
00183     pTC-&gt;<a class="code" href="classPUSTelecommand.html#a11">setAcknowledgeLevel</a>(0);        <span class="comment">// reset acknowledge flags</span>
00184     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_EXEC_SUCC);
00185     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a3">checkNoTmPacket</a>(pEvtRep) )
00186     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Unexpected packet"</span>);
00187         <span class="keywordflow">return</span>;
00188     }
00189 
00190     pTC-&gt;<a class="code" href="classDC__TestPUSTelecommand.html#a10">setActionOutcome</a>(<span class="keyword">true</span>);
00191     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pTC,EVT_TC_EXEC_FAIL);
00192     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a48">PUS_ST_TC_EXE_END_FL</a>,tcId_1,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),
00193                                                                             (<a class="code" href="BasicTypes_8h.html#a14">TD_CheckCode</a>)ACTION_SUCCESS) )
00194     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00195         <span class="keywordflow">return</span>;
00196     }
00197 
00198     pMan-&gt;<a class="code" href="classDC__TestPUSConfigurableManoeuvre.html#a7">setContinuationCheckCode</a>(0);
00199     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_ABORTED);
00200     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a46">PUS_ST_TC_EXE_PRO_FL</a>,tcId_2,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),EVT_MAN_ABORTED) )
00201     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00202         <span class="keywordflow">return</span>;
00203     }
00204 
00205     pMan-&gt;<a class="code" href="classDC__TestPUSConfigurableManoeuvre.html#a7">setContinuationCheckCode</a>(CONT_CODE);
00206     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_ABORTED);
00207     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a46">PUS_ST_TC_EXE_PRO_FL</a>,tcId_2,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),CONT_CODE) )
00208     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00209         <span class="keywordflow">return</span>;
00210     }
00211 
00212     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a5">setCompletionAckFlag</a>(<span class="keyword">true</span>);
00213     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_TERMINATED);
00214     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a2">checkTmPacket</a>(pEvtRep,<a class="code" href="Constants_8h.html#a47">PUS_ST_TC_EXE_END_SC</a>,tcId_2,<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>()-&gt;getTime(),0) )
00215     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00216         <span class="keywordflow">return</span>;
00217     }
00218 
00219     pMan-&gt;<a class="code" href="classPUSTcManoeuvre.html#a5">setCompletionAckFlag</a>(<span class="keyword">false</span>);
00220     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_TERMINATED);
00221     <span class="keywordflow">if</span> ( !<a class="code" href="classTestCasePUSEventRepository__1.html#a3">checkNoTmPacket</a>(pEvtRep) )
00222     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong packet configuration"</span>);
00223         <span class="keywordflow">return</span>;
00224     }
00225 
00226     <span class="comment">// Force a situation where the telemetry packet factory in the </span>
00227     <span class="comment">// PUS event repository runs out of telemetry packets and check that correct event is generated</span>
00228     <a class="code" href="classCC__TelemetryPacketFactory.html">CC_TelemetryPacketFactory</a>* pTMF = <a class="code" href="classCC__TelemetryPacketFactory.html#e0">CC_TelemetryPacketFactory::getInstance</a>();
00229     <span class="keywordflow">while</span> ( pTMF-&gt;<a class="code" href="classCC__TelemetryPacketFactory.html#a26">isFreePUSTcVerificationPacket</a>() )
00230         pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_ABORTED);
00231     nEvt = <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00232     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a1">create</a>(pMan,EVT_MAN_TERMINATED);
00233     <span class="keywordflow">if</span> ( <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>()!=nEvt+2 )
00234     {   setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong number of events"</span>);
00235         <span class="keywordflow">return</span>;
00236     }
00237     <span class="keywordflow">if</span> (!verifySpecificEvent(nEvt+1,EVT_TM_PCK_ALLOC_FAILURE))
00238         <span class="keywordflow">return</span>;
00239 
00240     <span class="comment">// If this point is reached, the test was successful</span>
00241     setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00242     <span class="keywordflow">return</span>;
00243 }
00244 
<a name="l00245"></a><a class="code" href="classTestCasePUSEventRepository__1.html#a2">00245</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSEventRepository__1.html#a2">TestCasePUSEventRepository_1::checkTmPacket</a>(
00246                         <a class="code" href="classDC__PUSEventRepository.html">DC_PUSEventRepository</a>* pEvtRep, <a class="code" href="BasicTypes_8h.html#a31">TD_TelemetrySubType</a> tmSubType,
00247                         TD_TelecommandId tcId, <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tt, TD_CheckCode errCode) {
00248 
00249     <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>* pTMM = pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a6">getTelemetryManager</a>();
00250     <a class="code" href="classTelemetryPacket.html">TelemetryPacket</a>* pTemp = pTMM-&gt;<a class="code" href="classCC__TelemetryManager.html#a7">getImmediateQueueEntry</a>(0);
00251     <span class="keywordflow">if</span> ( pTemp == pNULL )
00252         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00253 
00254     <span class="keywordflow">if</span> ( pTemp-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>()!=ID_PUSTCVERIFICATIONPACKET )
00255         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00256 
00257     <a class="code" href="classDC__PUSTcVerificationPacket.html">DC_PUSTcVerificationPacket</a>* pTM = (<a class="code" href="classDC__PUSTcVerificationPacket.html">DC_PUSTcVerificationPacket</a>*)pTemp;
00258 
00259     <span class="keywordflow">if</span> ( pTM-&gt;<a class="code" href="classPUSTelemetryPacket.html#a5">getSubType</a>()!=tmSubType )
00260         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00261 
00262     <span class="keywordflow">if</span> ( pTM-&gt;<a class="code" href="classDC__PUSTcVerificationPacket.html#a5">getTelecommandId</a>()!=tcId )
00263         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00264 
00265     <span class="keywordflow">if</span> ( pTM-&gt;<a class="code" href="classPUSTelemetryPacket.html#a6">getTimeTag</a>()!=tt )
00266         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00267 
00268     <span class="keywordflow">if</span> ( pTM-&gt;<a class="code" href="classPUSTelemetryPacket.html#a4">getType</a>()!=<a class="code" href="Constants_8h.html#a40">PUS_TYPE_TC_VER</a> )
00269         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00270 
00271     <span class="keywordflow">if</span> ( errCode!=0 )
00272         <span class="keywordflow">if</span> ( pTM-&gt;<a class="code" href="classDC__PUSTcVerificationPacket.html#a3">getErrorCode</a>()!=errCode )
00273             <span class="keywordflow">return</span> <span class="keyword">false</span>;
00274 
00275     <span class="comment">// Flush telemetry manager</span>
00276     pTMM-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00277 
00278     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00279 }
00280 
<a name="l00281"></a><a class="code" href="classTestCasePUSEventRepository__1.html#a3">00281</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSEventRepository__1.html#a3">TestCasePUSEventRepository_1::checkNoTmPacket</a>(<a class="code" href="classDC__PUSEventRepository.html">DC_PUSEventRepository</a>* pEvtRep) {
00282 
00283     <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>* pTMM = pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a6">getTelemetryManager</a>();
00284     <a class="code" href="classTelemetryPacket.html">TelemetryPacket</a>* pTemp = pTMM-&gt;<a class="code" href="classCC__TelemetryManager.html#a7">getImmediateQueueEntry</a>(0);
00285     <span class="keywordflow">if</span> ( pTemp == pNULL )
00286         <span class="keywordflow">return</span> <span class="keyword">true</span>;
00287     <span class="keywordflow">else</span>
00288         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00289 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
