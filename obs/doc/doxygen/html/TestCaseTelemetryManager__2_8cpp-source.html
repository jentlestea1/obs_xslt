<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseTelemetryManager_2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseTelemetryManager_2.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseTelemetryManager_2.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.1</span>
00007 <span class="comment">// Date         04.03.04</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/TestConstants.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00014 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00015 <span class="preprocessor">#include "../Event/DC_EventRepository.h"</span>
00016 <span class="preprocessor">#include "../Telemetry/DC_SimpleTelemetryModeManager.h"</span>
00017 <span class="preprocessor">#include "../Telemetry/DC_ByteArrayTelemetryStream.h"</span>
00018 <span class="preprocessor">#include "../Telemetry/DC_DummyTelemetryPacket.h"</span>
00019 <span class="preprocessor">#include "../Telemetry/CC_TelemetryManager.h"</span>
00020 <span class="preprocessor">#include "../Telemetry/TelemetryModeManager.h"</span>
00021 <span class="preprocessor">#include "TestCaseTelemetryManager_2.h"</span>
00022 
00023 
<a name="l00024"></a><a class="code" href="classTestCaseTelemetryManager__2.html#a0">00024</a> <a class="code" href="classTestCaseTelemetryManager__2.html#a0">TestCaseTelemetryManager_2::TestCaseTelemetryManager_2</a>(<span class="keywordtype">void</span>) :
00025         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_TELEMETRYMANAGER*10+2,"<a class="code" href="classTestCaseTelemetryManager__2.html">TestCaseTelemetryManager_2</a>") {
00026                 <span class="keywordflow">return</span>;
00027 }
00028 
<a name="l00029"></a><a class="code" href="classTestCaseTelemetryManager__2.html#a1">00029</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseTelemetryManager__2.html#a1">TestCaseTelemetryManager_2::runTestCase</a>(<span class="keywordtype">void</span>) {
00030 
00031    <span class="comment">// Retrieve the event repository and the event counter</span>
00032    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> nEvt = <a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00033 
00034    <span class="comment">// Create the telemetry manager</span>
00035    <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>* pTm = <span class="keyword">new</span> <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>();
00036 
00037    <span class="comment">// Create and configure the dummy telemetry packets</span>
00038    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d11 = 11;
00039    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d12 = 12;
00040    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d21 = 21;
00041    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> d22 = 22;
00042    <a class="code" href="classDC__DummyTelemetryPacket.html">DC_DummyTelemetryPacket</a>* pTW1 = <span class="keyword">new</span> <a class="code" href="classDC__DummyTelemetryPacket.html">DC_DummyTelemetryPacket</a>();
00043    DC_DummyTelemetryPacket* pTW2 = <span class="keyword">new</span> DC_DummyTelemetryPacket();
00044    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a6">setNumberOfBytes</a>(2);
00045    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(0,d11);
00046    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(1,d12);
00047    pTW2-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a6">setNumberOfBytes</a>(2);
00048    pTW2-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(0,d21);
00049    pTW2-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(1,d22);
00050 
00051    <span class="comment">// Create, configure and load the telemetry mode manager</span>
00052    <a class="code" href="classDC__SimpleTelemetryModeManager.html">DC_SimpleTelemetryModeManager</a>* pTmMm = <span class="keyword">new</span> <a class="code" href="classDC__SimpleTelemetryModeManager.html">DC_SimpleTelemetryModeManager</a>();
00053    pTmMm-&gt;<a class="code" href="classTelemetryListModeManager.html#a3">setListLength</a>(0,2);
00054    pTmMm-&gt;<a class="code" href="classTelemetryListModeManager.html#a1">setListItem</a>(0,0,pTW1);
00055    pTmMm-&gt;<a class="code" href="classTelemetryListModeManager.html#a1">setListItem</a>(0,1,pTW2);
00056    pTmMm-&gt;<a class="code" href="classModeManager.html#a10">reset</a>();
00057    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a1">setTelemetryModeManager</a>(pTmMm);
00058 
00059    <span class="comment">// Create, configure and load the telemetry stream</span>
00060    <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> <span class="keyword">const</span> size = 8;
00061    <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> tmData[size];      <span class="comment">// TM data are written here</span>
00062    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;size; i++)
00063        tmData[i] = 0;
00064    <a class="code" href="classDC__ByteArrayTelemetryStream.html">DC_ByteArrayTelemetryStream</a>* pTmSt = <span class="keyword">new</span> <a class="code" href="classDC__ByteArrayTelemetryStream.html">DC_ByteArrayTelemetryStream</a>();
00065    pTmSt-&gt;<a class="code" href="classDC__ByteArrayTelemetryStream.html#a4">setCapacity</a>(size);
00066    pTmSt-&gt;<a class="code" href="classDC__ByteArrayTelemetryStream.html#a5">setStartingAddress</a>(tmData);
00067    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a3">setTelemetryStream</a>(pTmSt);
00068    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a5">setImmediateQueueSize</a>(2);
00069 
00070    <span class="comment">// Check that the components are configured</span>
00071    <span class="keywordflow">if</span> ( ( !pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a13">isObjectConfigured</a>() ) ||
00072         ( !pTmMm-&gt;<a class="code" href="classTelemetryListModeManager.html#a7">isObjectConfigured</a>() ) ||
00073         ( !pTmSt-&gt;<a class="code" href="classDC__ByteArrayTelemetryStream.html#a9">isObjectConfigured</a>() ) ||
00074         ( !pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a8">isObjectConfigured</a>() ) ||
00075         ( !pTW2-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a8">isObjectConfigured</a>() ) )
00076    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong configuration status"</span>);
00077         <span class="keywordflow">return</span>;
00078    }
00079 
00080    <span class="comment">// Reset "in use" status</span>
00081    pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00082    pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00083 
00084    <span class="comment">// Load the TM packets, unload them and check success (try to unload pTW2 twice)</span>
00085    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a8">isImmediateQueueFull</a>())
00086    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong status of immediate dispatch queue"</span>);
00087         <span class="keywordflow">return</span>;
00088    }
00089    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a12">getImmediateQueueLoaded</a>()!=0)
00090    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of entries in immediate dispatch queue"</span>);
00091         <span class="keywordflow">return</span>;
00092    }
00093    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00094    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW2);
00095    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a12">getImmediateQueueLoaded</a>()!=2)
00096    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of entries in immediate dispatch queue"</span>);
00097         <span class="keywordflow">return</span>;
00098    }
00099    <span class="keywordflow">if</span> (!pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a8">isImmediateQueueFull</a>())
00100    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong status of immediate dispatch queue"</span>);
00101         <span class="keywordflow">return</span>;
00102    }
00103    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a11">unloadTelemetryPacket</a>(pTW2);
00104    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a12">getImmediateQueueLoaded</a>()!=1)
00105    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of entries in immediate dispatch queue"</span>);
00106         <span class="keywordflow">return</span>;
00107    }
00108    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a8">isImmediateQueueFull</a>())
00109    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong status of immediate dispatch queue"</span>);
00110         <span class="keywordflow">return</span>;
00111    }
00112    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a11">unloadTelemetryPacket</a>(pTW2);
00113    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a12">getImmediateQueueLoaded</a>()!=1)
00114    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of entries in immediate dispatch queue"</span>);
00115         <span class="keywordflow">return</span>;
00116    }
00117    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a11">unloadTelemetryPacket</a>(pTW1);
00118    <span class="keywordflow">if</span> (pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a12">getImmediateQueueLoaded</a>()!=0)
00119    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of entries in immediate dispatch queue"</span>);
00120         <span class="keywordflow">return</span>;
00121    }
00122 
00123    <span class="comment">// Activate telemetry manager and check correctness of values sent to TM stream</span>
00124    <span class="comment">// (Recall that the values encapsulated in the DC_DummyTelemetryPacket component</span>
00125    <span class="comment">// are incremented by 1 every time the component receives an update request)</span>
00126    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00127    <span class="keywordflow">if</span> ( ( tmData[0] != d11+1 ) || ( tmData[1] != d12+1 ) )
00128    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00129         <span class="keywordflow">return</span>;
00130    }
00131    <span class="keywordflow">if</span> ( ( tmData[2] != d21+1 ) || ( tmData[3] != d22+1 ) )
00132    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00133         <span class="keywordflow">return</span>;
00134    }
00135 
00136    <span class="comment">// Check that "in use" status has not been changed</span>
00137    <span class="keywordflow">if</span> ( !pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00138    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00139         <span class="keywordflow">return</span>;
00140    }
00141    <span class="keywordflow">if</span> ( !pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00142    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00143         <span class="keywordflow">return</span>;
00144    }
00145 
00146    <span class="comment">// Submit telemetry packets for immediate dispatch, activate telemetry manager</span>
00147    <span class="comment">// and check that telemetry data are correctly written to telemetry stream</span>
00148    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00149    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW2);
00150    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00151    <span class="keywordflow">if</span> ( ( tmData[0] != d11+2 ) || ( tmData[1] != d12+2 ) )
00152    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00153         <span class="keywordflow">return</span>;
00154    }
00155    <span class="keywordflow">if</span> ( ( tmData[2] != d21+2 ) || ( tmData[3] != d22+2 ) )
00156    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00157         <span class="keywordflow">return</span>;
00158    }
00159    <span class="keywordflow">if</span> ( ( tmData[4] != d11+3 ) || ( tmData[5] != d12+3 ) )
00160    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00161         <span class="keywordflow">return</span>;
00162    }
00163    <span class="keywordflow">if</span> ( ( tmData[6] != d21+3 ) || ( tmData[7] != d22+3 ) )
00164    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00165         <span class="keywordflow">return</span>;
00166    }
00167 
00168    <span class="comment">// Check that "in use" status has been set to "not in use"</span>
00169    <span class="keywordflow">if</span> ( pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00170    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00171         <span class="keywordflow">return</span>;
00172    }
00173    <span class="keywordflow">if</span> ( pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00174    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00175         <span class="keywordflow">return</span>;
00176    }
00177 
00178    <span class="comment">// Reset "in use" status</span>
00179    pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00180    pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00181 
00182    <span class="comment">// Reset the array where telemetry data are written</span>
00183    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;size; i++)
00184        tmData[i] = 0;
00185 
00186    <span class="comment">// Force the first telemetry packet to be "not valid"</span>
00187    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a4">setValidStatus</a>(<a class="code" href="Constants_8h.html#a4">NOT_VALID</a>);
00188 
00189    <span class="comment">// Activate telemetry manager and check that only the second telemetry packet</span>
00190    <span class="comment">// is sent to TM stream</span>
00191    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00192    <span class="keywordflow">if</span> ( ( tmData[0] != d21+4 ) || ( tmData[1] != d22+4 ) )
00193    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00194         <span class="keywordflow">return</span>;
00195    }
00196    <span class="keywordflow">if</span> ( ( tmData[2] != 0 ) || ( tmData[3] != 0 ) )
00197    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00198         <span class="keywordflow">return</span>;
00199    }
00200 
00201    <span class="comment">// Check that the correct event was generated</span>
00202    <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+1,EVT_TM_ITEM_NOT_VALID) )
00203         <span class="keywordflow">return</span>;
00204    nEvt++;
00205 
00206    <span class="comment">// Decrease the size of the telemetry stream and make the telemetry</span>
00207    <span class="comment">// valid again</span>
00208    pTmSt-&gt;<a class="code" href="classDC__ByteArrayTelemetryStream.html#a4">setCapacity</a>(3);
00209    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a4">setValidStatus</a>(<a class="code" href="Constants_8h.html#a5">VALID</a>);
00210 
00211    <span class="comment">// Activate the telemetry manager and check that the correct event is generated</span>
00212    <span class="comment">// (The second telemetry packet should have been rejected)</span>
00213    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00214    <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+1,EVT_TOO_MANY_TM_BYTES ) )
00215         <span class="keywordflow">return</span>;
00216    nEvt++;
00217 
00218    <span class="comment">// Reset the array where telemetry data are written, reset the</span>
00219    <span class="comment">// size of the telemetry stream, and reset the values of the telemetry packets</span>
00220    pTmSt-&gt;<a class="code" href="classDC__ByteArrayTelemetryStream.html#a4">setCapacity</a>(size);
00221    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(0,d11);
00222    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(1,d12);
00223    pTW2-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(0,d21);
00224    pTW2-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a5">setValue</a>(1,d22);
00225    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;size; i++)
00226        tmData[i] = 0;
00227 
00228    <span class="comment">// Force the first telemetry packet to be "not valid" and submit it for</span>
00229    <span class="comment">// immediate dispatch to the telemetry stream. Activate the telemetry manager.</span>
00230    <span class="comment">// The immediate dispatch packet should not be written to the telemetry stream.</span>
00231    <span class="comment">// Two events should be generated (the telemetry packet is sent twice!)</span>
00232    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a4">setValidStatus</a>(<a class="code" href="Constants_8h.html#a4">NOT_VALID</a>);
00233    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00234    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00235    <span class="keywordflow">if</span> ( ( tmData[4] != 0 ) || ( tmData[5] != 0 ) )
00236    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00237         <span class="keywordflow">return</span>;
00238    }
00239    <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+2,EVT_TM_ITEM_NOT_VALID) )
00240         <span class="keywordflow">return</span>;
00241    <span class="keywordflow">if</span> ( !verifySpecificEvent(nEvt+1,EVT_TM_ITEM_NOT_VALID) )
00242         <span class="keywordflow">return</span>;
00243    nEvt++;
00244    nEvt++;
00245 
00246    <span class="comment">// Check that "in use" status of pTW1 has been set to "not in use"</span>
00247    <span class="keywordflow">if</span> ( pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00248    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00249         <span class="keywordflow">return</span>;
00250    }
00251    <span class="keywordflow">if</span> ( !pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00252    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00253         <span class="keywordflow">return</span>;
00254    }
00255 
00256    <span class="comment">// Reset "in use" status</span>
00257    pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00258    pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00259 
00260    <span class="comment">// Reset the array where telemetry data are written</span>
00261    <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;size; i++)
00262        tmData[i] = 0;
00263 
00264    <span class="comment">// Decrease the size of the telemetry stream to make it too small for the</span>
00265    <span class="comment">// telemetry packet, make the telemetry valid again, and resubmit for sending</span>
00266    <span class="comment">// to the TM stream</span>
00267    <span class="comment">// Nothing should be written to the TM stream and two events should be generated</span>
00268    <span class="comment">// (one for the repetitive packet and one for the immediate dispatch packet)</span>
00269    pTmSt-&gt;<a class="code" href="classDC__ByteArrayTelemetryStream.html#a4">setCapacity</a>(1);
00270    pTW1-&gt;<a class="code" href="classDC__DummyTelemetryPacket.html#a4">setValidStatus</a>(<a class="code" href="Constants_8h.html#a5">VALID</a>);
00271    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00272    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00273    <span class="keywordflow">if</span> ( ( tmData[0] != 0 ) || ( tmData[1] != 0 ) )
00274    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong data written to telemetry stream"</span>);
00275         <span class="keywordflow">return</span>;
00276    }
00277    <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+2,EVT_TOO_MANY_TM_BYTES) )
00278         <span class="keywordflow">return</span>;
00279    <span class="keywordflow">if</span> ( !verifySpecificEvent(nEvt+1,EVT_TOO_MANY_TM_BYTES) )
00280         <span class="keywordflow">return</span>;
00281    nEvt++;
00282    nEvt++;
00283 
00284    <span class="comment">// Check that "in use" status of pTW1 has been set to "not in use"</span>
00285    <span class="keywordflow">if</span> ( pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00286    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00287         <span class="keywordflow">return</span>;
00288    }
00289    <span class="keywordflow">if</span> ( !pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a16">isInUse</a>() )
00290    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong inUse status"</span>);
00291         <span class="keywordflow">return</span>;
00292    }
00293 
00294    <span class="comment">// Reset "in use" status</span>
00295    pTW1-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00296    pTW2-&gt;<a class="code" href="classTelemetryPacket.html#a15">setInUse</a>(<span class="keyword">true</span>);
00297    <span class="comment">// Try to submit three packets for immediate dispatch (the capacity of the</span>
00298    <span class="comment">// imemdiate dispatch queue is 2) and check that the correct event is generated</span>
00299    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00300    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00301    pTm-&gt;<a class="code" href="classCC__TelemetryManager.html#a10">sendTelemetryPacket</a>(pTW1);
00302    <span class="keywordflow">if</span> ( !verifyLatestEvent(nEvt+1,EVT_TM_QUEUE_FULL) )
00303         <span class="keywordflow">return</span>;
00304    nEvt++;
00305 
00306    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00307    <span class="keywordflow">return</span>;
00308 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
