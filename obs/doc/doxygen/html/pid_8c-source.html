<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: pid.c Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>pid.c</h1><pre class="fragment"><div>00001 <span class="preprocessor">#pragma warning(disable:4001)</span>
00002 <span class="preprocessor"></span>
00003 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00004 
00005 <span class="preprocessor">#ifndef HAVE_SIMULINK</span>
00006 <span class="preprocessor"></span>
00007 <span class="comment">/*</span>
00008 <span class="comment"> * We need this to keep Visual C++ happy: trying to compile an empty file is</span>
00009 <span class="comment"> * a fatal error (sic).</span>
00010 <span class="comment"> * On the other side, we have to comment out the whole file if we want to be able</span>
00011 <span class="comment"> * to compile the Obs Framework on machines where Matlab + Simulink are not installed.</span>
00012 <span class="comment"> */</span>
00013 <span class="keywordtype">void</span> PID_dummy(<span class="keywordtype">void</span>) {
00014     <span class="keywordflow">return</span>;
00015 }
00016 
00017 <span class="preprocessor">#else</span>
00018 <span class="preprocessor"></span>
00019 <span class="comment">/*</span>
00020 <span class="comment"> * Real-Time Workshop code generation for Simulink model "PID.mdl".</span>
00021 <span class="comment"> *</span>
00022 <span class="comment"> * Model Version                        : 1.15</span>
00023 <span class="comment"> * Real-Time Workshop file version      : 5.0 $Date: 2004/01/16 06:53:50 $</span>
00024 <span class="comment"> * Real-Time Workshop file generated on : Mon Jun 02 11:22:38 2003</span>
00025 <span class="comment"> * TLC version                          : 5.0 (Jun 18 2002)</span>
00026 <span class="comment"> * C source code generated on           : Mon Jun 02 11:22:38 2003</span>
00027 <span class="comment"> */</span>
00028 
00029 <span class="preprocessor">#include "PID.h"</span>
00030 <span class="preprocessor">#include "PID_private.h"</span>
00031 
00032 <span class="comment">/* Exported block signals */</span>
00033 real_T Output;                          <span class="comment">/* &lt;Root&gt;/Sum */</span>
00034 real_T Input;                           <span class="comment">/* &lt;Root&gt;/Input */</span>
00035 
00036 <span class="comment">/* Exported block parameters */</span>
00037 real_T Kd = 1.0;
00038 real_T Ki = 1.0;
00039 real_T Kp = -1.0;
00040 
00041 <span class="comment">/* Block signals (auto storage) */</span>
00042 BlockIO_PID PID_B;
00043 
00044 <span class="comment">/* Block states (auto storage) */</span>
00045 D_Work_PID PID_DWork;
00046 
00047 <span class="comment">/* Real-time model */</span>
00048 RT_MODEL_PID PID_M_;
00049 RT_MODEL_PID *PID_M = &amp;PID_M_;
00050 
00051 <span class="comment">/* Model step function */</span>
00052 <span class="keywordtype">void</span> PID_step(<span class="keywordtype">void</span>)
00053 {
00054   <span class="comment">/* local block i/o variables */</span>
00055   real_T rtb_I_Gain;
00056   real_T rtb_D_Gain;
00057   real_T rtb_Discrete_Transfer_Fcn;
00058 
00059   <span class="comment">/* Gain: '&lt;Root&gt;/I Gain' incorporates:</span>
00060 <span class="comment">   *   Inport: '&lt;Root&gt;/Input'</span>
00061 <span class="comment">   *</span>
00062 <span class="comment">   * Regarding '&lt;Root&gt;/I Gain':</span>
00063 <span class="comment">   *   Gain value: Ki</span>
00064 <span class="comment">   */</span>
00065   rtb_I_Gain = Input * Ki;
00066 
00067   <span class="comment">/* DiscreteIntegrator: '&lt;Root&gt;/Discrete-Time Integrator'</span>
00068 <span class="comment">   *</span>
00069 <span class="comment">   * Regarding '&lt;Root&gt;/Discrete-Time Integrator':</span>
00070 <span class="comment">   *    Unlimited, w/o Saturation Port</span>
00071 <span class="comment">   */</span>
00072   <span class="comment">/* system was just enabled */</span>
00073   <span class="keywordflow">if</span> ( PID_DWork.Discrete_Time_Int_SYSTEM_ENABLE) {
00074     PID_DWork.Discrete_Time_Int_SYSTEM_ENABLE = <span class="keyword">false</span>;
00075     PID_B.Discrete_Time_Int = PID_DWork.Discrete_Time_Int_DSTATE;
00076   } <span class="keywordflow">else</span> {
00077     PID_B.Discrete_Time_Int = PID_DWork.Discrete_Time_Int_DSTATE + 0.125 *
00078       rtb_I_Gain;
00079   }
00080 
00081   <span class="comment">/* Gain: '&lt;Root&gt;/D Gain' incorporates:</span>
00082 <span class="comment">   *   Inport: '&lt;Root&gt;/Input'</span>
00083 <span class="comment">   *</span>
00084 <span class="comment">   * Regarding '&lt;Root&gt;/D Gain':</span>
00085 <span class="comment">   *   Gain value: Kd</span>
00086 <span class="comment">   */</span>
00087   rtb_D_Gain = Input * Kd;
00088 
00089   <span class="comment">/* DiscreteTransferFcn: '&lt;Root&gt;/Discrete Transfer Fcn' */</span>
00090   rtb_Discrete_Transfer_Fcn = 4.0*rtb_D_Gain;
00091   rtb_Discrete_Transfer_Fcn += -4.0*PID_DWork.Discrete_Transfer_Fcn_DSTATE;
00092 
00093   <span class="comment">/* Sum: '&lt;Root&gt;/Sum' incorporates:</span>
00094 <span class="comment">   *   Gain: '&lt;Root&gt;/P Gain'</span>
00095 <span class="comment">   *   Inport: '&lt;Root&gt;/Input'</span>
00096 <span class="comment">   *</span>
00097 <span class="comment">   * Regarding '&lt;Root&gt;/P Gain':</span>
00098 <span class="comment">   *   Gain value: Kp</span>
00099 <span class="comment">   */</span>
00100   Output = (Input * Kp) + PID_B.Discrete_Time_Int + rtb_Discrete_Transfer_Fcn;
00101 
00102   <span class="comment">/* DiscreteIntegrator Block: &lt;Root&gt;/Discrete-Time Integrator */</span>
00103   PID_DWork.Discrete_Time_Int_DSTATE = PID_B.Discrete_Time_Int + 0.125 *
00104     rtb_I_Gain;
00105 
00106   <span class="comment">/* DiscreteTransferFcn Block: &lt;Root&gt;/Discrete Transfer Fcn */</span>
00107   {
00108     PID_DWork.Discrete_Transfer_Fcn_DSTATE = rtb_D_Gain +
00109       (0.0)*PID_DWork.Discrete_Transfer_Fcn_DSTATE;
00110   }
00111 }
00112 
00113 <span class="comment">/* Model initialize function */</span>
00114 <span class="keywordtype">void</span> PID_initialize(boolean_T firstTime)
00115 {
00116   <span class="keywordflow">if</span> (firstTime) {
00117     <span class="comment">/* registration code */</span>
00118     rtmSetErrorStatus(PID_M, (<span class="keyword">const</span> char_T *)0);
00119 
00120     <span class="comment">/* block I/O */</span>
00121     {
00122       <span class="keywordtype">void</span> *b = (<span class="keywordtype">void</span> *) &amp;PID_B;
00123       {
00124         int_T i;
00125 
00126         b =&amp;PID_B.Discrete_Time_Int;
00127         <span class="keywordflow">for</span> (i = 0; i &lt; 1; i++) {
00128           ((real_T*)b)[i] = 0.0;
00129         }
00130       }
00131 
00132       <span class="comment">/* exported global signals */</span>
00133       Output = 0.0;
00134     }
00135 
00136     <span class="comment">/* data type work */</span>
00137     (<span class="keywordtype">void</span>)memset((char_T *) &amp;PID_DWork, 0, <span class="keyword">sizeof</span>(D_Work_PID));
00138     {
00139       int_T i;
00140       real_T *dwork_ptr = (real_T *) &amp;PID_DWork.Discrete_Time_Int_DSTATE;
00141 
00142       <span class="keywordflow">for</span> (i = 0; i &lt; 2; i++) {
00143         dwork_ptr[i] = 0.0;
00144       }
00145     }
00146 
00147     <span class="comment">/* external inputs */</span>
00148     Input = 0.0;
00149 
00150     <span class="comment">/* external outputs */</span>
00151     Output = 0.0;
00152   }
00153 
00154   <span class="comment">/* DiscreteIntegrator Block: &lt;Root&gt;/Discrete-Time Integrator */</span>
00155   PID_DWork.Discrete_Time_Int_SYSTEM_ENABLE = <span class="keyword">true</span>;
00156 }
00157 
00158 <span class="comment">/* Model terminate function */</span>
00159 <span class="keywordtype">void</span> PID_terminate(<span class="keywordtype">void</span>)
00160 {
00161   <span class="comment">/* (no terminate code required) */</span>
00162 }
00163 
00164 <span class="preprocessor">#endif</span>
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
