<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCasePUSFull.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCasePUSFull.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCasePUSFull.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         13.01.04</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "TestCasePUSFull.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/TestConstants.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00014 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00015 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00016 <span class="preprocessor">#include "../System/DC_DummyObsClock.h"</span>
00017 <span class="preprocessor">#include "../Event/DC_PUSEventRepository.h"</span>
00018 <span class="preprocessor">#include "../Data/DC_DummyDataPool.h"</span>
00019 <span class="preprocessor">#include "../Data/DC_DummyDatabase.h"</span>
00020 <span class="preprocessor">#include "../Manoeuvre/CC_ManoeuvreManager.h"</span>
00021 <span class="preprocessor">#include "../Telemetry/CC_TelemetryManager.h"</span>
00022 <span class="preprocessor">#include "../Telemetry/DC_PUSTelemetryModeManager.h"</span>
00023 <span class="preprocessor">#include "../Telemetry/DC_PUSDataReportingPacket.h"</span>
00024 <span class="preprocessor">#include "../Telemetry/DC_PUSTmLogger.h"</span>
00025 <span class="preprocessor">#include "../Telemetry/TelemetryPacket.h"</span>
00026 <span class="preprocessor">#include "../Telecommand/CC_TelecommandManager.h"</span>
00027 <span class="preprocessor">#include "../Telecommand/DC_BasicPUSTcLoader.h"</span>
00028 <span class="preprocessor">#include "../Telecommand/TelecommandLoader.h"</span>
00029 <span class="preprocessor">#include "../Telecommand/PUSTelecommand.h"</span>
00030 
00031 <span class="preprocessor">#include &lt;string.h&gt;</span>
00032 <span class="preprocessor">#include &lt;assert.h&gt;</span>
00033 
00034 <span class="keywordtype">bool</span> TestCasePUSFull::firstActivation = <span class="keyword">true</span>;
00035 
00036 <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>* TestCasePUSFull::pTmManager = pNULL;
00037 <a class="code" href="classDC__PUSTelemetryModeManager.html">DC_PUSTelemetryModeManager</a>* TestCasePUSFull::pTmModeMan = pNULL;
00038 <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>* TestCasePUSFull::pTcManager = pNULL;
00039 <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a>* TestCasePUSFull::pManManager = pNULL;
00040 <a class="code" href="classDC__PUSTmLogger.html">DC_PUSTmLogger</a>* TestCasePUSFull::pTmLogger = pNULL;
00041 <a class="code" href="classDC__BasicPUSTcLoader.html">DC_BasicPUSTcLoader</a>* TestCasePUSFull::pTcLoader = pNULL;
00042 <a class="code" href="classDC__PUSEventRepository.html">DC_PUSEventRepository</a>* TestCasePUSFull::pEvtRep = pNULL;
00043 <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>* TestCasePUSFull::pObsClock = pNULL;
00044 
00045 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> TestCasePUSFull::tcCommandArea[<a class="code" href="TestConstants_8h.html#a34">TC_COMMAND_AREA_MAX_N_TC</a>*<a class="code" href="TestConstants_8h.html#a35">TC_COMMAND_AREA_MAX_TC_LEN</a>];
00046 
<a name="l00047"></a><a class="code" href="classTestCasePUSFull.html#a0">00047</a> <a class="code" href="classTestCasePUSFull.html#a0">TestCasePUSFull::TestCasePUSFull</a>(<span class="keywordtype">int</span> testId, <span class="keywordtype">char</span>* testName):
00048      <a class="code" href="classTestCaseWithFactories.html">TestCaseWithFactories</a>(testId,testName) {
00049      <span class="keywordflow">return</span>;
00050 }
00051 
<a name="l00052"></a><a class="code" href="classTestCasePUSFull.html#a1">00052</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSFull.html#a1">TestCasePUSFull::setUpTestCase</a>(<span class="keywordtype">void</span>) {
00053 
00054    <span class="keywordflow">if</span> (!<a class="code" href="classTestCaseWithFactories.html#a1">TestCaseWithFactories::setUpTestCase</a>()) 
00055        <span class="keywordflow">return</span> <a class="code" href="TestConstants_8h.html#a3">INITIALIZATION_FAILURE</a>;
00056 
00057    <span class="keywordflow">if</span> (firstActivation) {
00058 
00059       <span class="comment">// Create the components</span>
00060       pTmManager = <span class="keyword">new</span> <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>();
00061       pTmModeMan = <span class="keyword">new</span> <a class="code" href="classDC__PUSTelemetryModeManager.html">DC_PUSTelemetryModeManager</a>();
00062       pTcManager = <span class="keyword">new</span> <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>();
00063       pManManager = <span class="keyword">new</span> <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a>();
00064       pTmLogger = <span class="keyword">new</span> <a class="code" href="classDC__PUSTmLogger.html">DC_PUSTmLogger</a>();
00065       pTcLoader = <span class="keyword">new</span> <a class="code" href="classDC__BasicPUSTcLoader.html">DC_BasicPUSTcLoader</a>();
00066       pEvtRep = <span class="keyword">new</span> <a class="code" href="classDC__PUSEventRepository.html">DC_PUSEventRepository</a>();
00067       pObsClock = <span class="keyword">new</span> <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>();
00068 
00069      <span class="comment">// Configure the non-changeable part of the tc manager</span>
00070      <span class="keywordflow">if</span> ( pTcManager-&gt;<a class="code" href="classCC__TelecommandManager.html#a14">isObjectConfigured</a>() )
00071         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00072      pTcManager-&gt;<a class="code" href="classCC__TelecommandManager.html#a2">setPendingTelecommandListSize</a>(<a class="code" href="TestConstants_8h.html#a30">TC_MAN_PEND_TC_LIST_SIZE</a>);
00073 
00074      <span class="comment">// Configure the non-changeable part of the tm mode manager</span>
00075      <span class="keywordflow">if</span> ( pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a13">isObjectConfigured</a>() )
00076         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00077      pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a8">setMaxNumberOfPackets</a>(<a class="code" href="TestConstants_8h.html#a32">TM_MODE_MAN_MAX_N_PACKETS</a>);
00078 
00079      <span class="comment">// Configure the non-changeable part of the tm manager</span>
00080      <span class="keywordflow">if</span> ( pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a13">isObjectConfigured</a>() )
00081         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00082      pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a5">setImmediateQueueSize</a>(<a class="code" href="TestConstants_8h.html#a31">TM_MAN_IMMEDIATE_QUEUE</a>);
00083 
00084      <span class="comment">// Configure the non-changeable part of the manoeuvre manager</span>
00085      <span class="keywordflow">if</span> ( pManManager-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a8">isObjectConfigured</a>() )
00086         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00087      pManManager-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a2">setPendingManoeuvreListSize</a>(<a class="code" href="TestConstants_8h.html#a33">MAN_MAN_PENDING_MAN_LIST_SIZE</a>);
00088 
00089      <span class="comment">// Configure the non-changeable part of the tc loader</span>
00090      <span class="keywordflow">if</span> ( pTcLoader-&gt;<a class="code" href="classDC__BasicPUSTcLoader.html#a8">isObjectConfigured</a>() )
00091         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00092 
00093      <span class="comment">// Configure the non-changeable part of the tm stream</span>
00094      <span class="keywordflow">if</span> ( pTmLogger-&gt;<a class="code" href="classDC__PUSTmLogger.html#a13">isObjectConfigured</a>() )
00095         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00096      pTmLogger-&gt;<a class="code" href="classDC__PUSTmLogger.html#a1">setBufferCapacity</a>(<a class="code" href="TestConstants_8h.html#a36">TM_LOGGER_BUFFER_CAPACITY</a>);
00097      pTmLogger-&gt;<a class="code" href="classDC__PUSTmLogger.html#a3">setMaxPacketLength</a>(<a class="code" href="TestConstants_8h.html#a37">TM_LOGGER_MAX_TM_LENGTH</a>);
00098      <span class="keywordflow">if</span> ( !pTmLogger-&gt;<a class="code" href="classDC__PUSTmLogger.html#a13">isObjectConfigured</a>() )
00099          <span class="keywordflow">return</span> <span class="keyword">false</span>;
00100 
00101       <span class="comment">// Configure the non-changeable part of the evt repository</span>
00102       <span class="keywordflow">if</span> ( pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a4">isObjectConfigured</a>() )
00103         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00104       pEvtRep-&gt;<a class="code" href="classDC__EventRepository.html#a1">setRepositorySize</a>(<a class="code" href="TestConstants_8h.html#a38">PUS_EVT_REP_SIZE</a>);
00105 
00106      firstActivation = <span class="keyword">false</span>;
00107    }
00108 
00109    <span class="comment">// Configure the updatable part of the tc manager</span>
00110    pTcManager-&gt;<a class="code" href="classCC__TelecommandManager.html#a11">setObsClock</a>(<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>());
00111    pTcManager-&gt;<a class="code" href="classCC__TelecommandManager.html#a9">setTelecommandLoader</a>(pTcLoader);
00112    <span class="keywordflow">if</span> ( !pTcManager-&gt;<a class="code" href="classCC__TelecommandManager.html#a14">isObjectConfigured</a>() )
00113         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00114 
00115    <span class="comment">// Configure the updatable part of the tm mode manager</span>
00116    pTmModeMan-&gt;<a class="code" href="classModeManager.html#a10">reset</a>();
00117    <span class="keywordflow">if</span> ( !pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a13">isObjectConfigured</a>() )
00118         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00119 
00120    <span class="comment">// Configure the updatable part of the tm manager</span>
00121    pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a3">setTelemetryStream</a>(pTmLogger);
00122    pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a1">setTelemetryModeManager</a>(pTmModeMan);
00123    <span class="keywordflow">if</span> ( !pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a13">isObjectConfigured</a>() )
00124         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00125 
00126    <span class="comment">// Configure the updatable part of the manoeuvre manager</span>
00127    <span class="keywordflow">if</span> ( !pManManager-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a8">isObjectConfigured</a>() )
00128         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00129 
00130    <span class="comment">// Configure the updatable part of the tc loader</span>
00131    pTcLoader-&gt;<a class="code" href="classDC__BasicPUSTcLoader.html#a6">setMaxNumberOfTc</a>(<a class="code" href="TestConstants_8h.html#a34">TC_COMMAND_AREA_MAX_N_TC</a>);
00132    pTcLoader-&gt;<a class="code" href="classDC__BasicPUSTcLoader.html#a4">setMaxTcLength</a>(<a class="code" href="TestConstants_8h.html#a35">TC_COMMAND_AREA_MAX_TC_LEN</a>);
00133    pTcLoader-&gt;<a class="code" href="classDC__BasicPUSTcLoader.html#a3">setTcLoadAreaStart</a>(tcCommandArea);
00134    pTcLoader-&gt;<a class="code" href="classTelecommandLoader.html#a3">setTelecommandManager</a>(pTcManager);
00135    <span class="keywordflow">if</span> ( !pTcLoader-&gt;<a class="code" href="classDC__BasicPUSTcLoader.html#a8">isObjectConfigured</a>() )
00136         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00137 
00138     <span class="comment">// Configure the updatable part of the evt repository</span>
00139     pEvtRep-&gt;<a class="code" href="classDC__EventRepository.html#a14">setObsClock</a>(<a class="code" href="classTestCasePUSFull.html#a9">getObsClock</a>());
00140     pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a5">setTelemetryManager</a>(pTmManager);
00141     <span class="keywordflow">if</span> ( !pEvtRep-&gt;<a class="code" href="classDC__PUSEventRepository.html#a4">isObjectConfigured</a>() )
00142         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00143 
00144     <span class="comment">// Swap the event repository</span>
00145     pOldEvtRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00146     CC_RootObject::setEventRepository(pEvtRep);
00147 
00148     <span class="comment">// Reset the telecommand load area</span>
00149     <a class="code" href="classTestCasePUSFull.html#a14">resetCommandLoadArea</a>();
00150 
00151     <span class="comment">// Clear the mode manager of any packets that were loaded in previous tests  </span>
00152     <span class="keywordflow">for</span> (pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a10">first</a>(); !pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a12">isIterationFinished</a>(); pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a11">next</a>()) {
00153         <a class="code" href="classTelemetryPacket.html">TelemetryPacket</a>* pTP = pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a2">getIterationTelemetryPacket</a>();
00154 
00155         <span class="keywordflow">if</span> (pTP-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>()!=ID_PUSDATAREPORTINGPACKET)
00156 
00157             <span class="keywordflow">return</span> <a class="code" href="TestConstants_8h.html#a3">INITIALIZATION_FAILURE</a>;
00158 
00159         <span class="keywordflow">else</span>
00160 
00161             pTmModeMan-&gt;<a class="code" href="classDC__PUSTelemetryModeManager.html#a4">unloadPacket</a>( ((<a class="code" href="classDC__PUSDataReportingPacket.html">DC_PUSDataReportingPacket</a>*)pTP)-&gt;getSID());
00162 
00163     }
00164 
00165 
00166     <span class="comment">// Flush the functionality managers</span>
00167     pTcManager-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00168     pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00169     pTmManager-&gt;<a class="code" href="classCC__TelemetryManager.html#a9">activate</a>();
00170 
00171     <span class="keywordflow">return</span> <a class="code" href="TestConstants_8h.html#a2">INITIALIZATION_SUCCESS</a>;
00172 }
00173 
<a name="l00174"></a><a class="code" href="classTestCasePUSFull.html#a2">00174</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSFull.html#a2">TestCasePUSFull::shutDownTestCase</a>(<span class="keywordtype">void</span>) {
00175      
00176    <span class="comment">// restore the event repository</span>
00177    CC_RootObject::setEventRepository(pOldEvtRep);
00178 
00179    <span class="keywordflow">return</span> <a class="code" href="TestConstants_8h.html#a4">SHUTDOWN_SUCCESS</a>;
00180 }
00181 
<a name="l00182"></a><a class="code" href="classTestCasePUSFull.html#a3">00182</a> <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>* <a class="code" href="classTestCasePUSFull.html#a3">TestCasePUSFull::getTelecommandManager</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00183     <span class="keywordflow">return</span> pTcManager;
00184 }
00185 
<a name="l00186"></a><a class="code" href="classTestCasePUSFull.html#a4">00186</a> <a class="code" href="classCC__TelemetryManager.html">CC_TelemetryManager</a>* <a class="code" href="classTestCasePUSFull.html#a4">TestCasePUSFull::getTelemetryManager</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00187     <span class="keywordflow">return</span> pTmManager;
00188 }
00189 
<a name="l00190"></a><a class="code" href="classTestCasePUSFull.html#a5">00190</a> <a class="code" href="classDC__PUSTelemetryModeManager.html">DC_PUSTelemetryModeManager</a>* <a class="code" href="classTestCasePUSFull.html#a5">TestCasePUSFull::getTelemetryModeManager</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00191     <span class="keywordflow">return</span> pTmModeMan;
00192 }
00193 
<a name="l00194"></a><a class="code" href="classTestCasePUSFull.html#a6">00194</a> <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a>* <a class="code" href="classTestCasePUSFull.html#a6">TestCasePUSFull::getManoeuvreManager</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00195    <span class="keywordflow">return</span> pManManager;
00196 }
00197 
<a name="l00198"></a><a class="code" href="classTestCasePUSFull.html#a7">00198</a> <a class="code" href="classDC__BasicPUSTcLoader.html">DC_BasicPUSTcLoader</a>* <a class="code" href="classTestCasePUSFull.html#a7">TestCasePUSFull::getTcLoader</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00199     <span class="keywordflow">return</span> pTcLoader;
00200 }
00201 
<a name="l00202"></a><a class="code" href="classTestCasePUSFull.html#a8">00202</a> <a class="code" href="classDC__PUSTmLogger.html">DC_PUSTmLogger</a>* <a class="code" href="classTestCasePUSFull.html#a8">TestCasePUSFull::getTmStream</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00203     <span class="keywordflow">return</span> pTmLogger;
00204 }
00205 
<a name="l00206"></a><a class="code" href="classTestCasePUSFull.html#a9">00206</a> <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>* <a class="code" href="classTestCasePUSFull.html#a9">TestCasePUSFull::getObsClock</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00207     <span class="keywordflow">return</span> pObsClock;
00208 }
00209 
<a name="l00210"></a><a class="code" href="classTestCasePUSFull.html#a10">00210</a> <a class="code" href="classDC__PUSEventRepository.html">DC_PUSEventRepository</a>* <a class="code" href="classTestCasePUSFull.html#a10">TestCasePUSFull::getEventRepository</a>(<span class="keywordtype">void</span>)<span class="keyword"> const </span>{
00211     <span class="keywordflow">return</span> pEvtRep;
00212 }
00213 
<a name="l00214"></a><a class="code" href="classTestCasePUSFull.html#a14">00214</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSFull.html#a14">TestCasePUSFull::resetCommandLoadArea</a>(<span class="keywordtype">void</span>) {
00215     tcCmdPos = 1;
00216     tcCommandArea[0] = 0;
00217 }
00218 
<a name="l00219"></a><a class="code" href="classTestCasePUSFull.html#b0">00219</a> <span class="keywordtype">void</span> <a class="code" href="classTestCasePUSFull.html#b0">TestCasePUSFull::writeTcHeader</a>(<span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> length, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetSeqControl) {
00220     <a class="code" href="BasicTypes_8h.html#a20">TD_PUSPacketId</a> <span class="keywordtype">id</span> = <a class="code" href="classPUSTelecommand.html#e0">PUSTelecommand::getPacketId</a>();
00221     assert(<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a20">TD_PUSPacketId</a>)==2);
00222     memcpy(tcCommandArea+tcCmdPos,&amp;<span class="keywordtype">id</span>,2);
00223     memcpy(tcCommandArea+tcCmdPos+2,&amp;packetSeqControl,2);
00224     memcpy(tcCommandArea+tcCmdPos+4,&amp;length,2);
00225     tcCmdPos = tcCmdPos+6;
00226 }
00227 
<a name="l00228"></a><a class="code" href="classTestCasePUSFull.html#a11">00228</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSFull.html#a11">TestCasePUSFull::writeTestPUSTelecommand</a>(
00229                         <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ackField, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> execCounter, <span class="keywordtype">bool</span> execCheckVal,
00230                         <span class="keywordtype">bool</span> valCheckVal, <a class="code" href="BasicTypes_8h.html#a14">TD_CheckCode</a> execCheckCode,
00231                         TD_CheckCode valCheckCode, <span class="keywordtype">bool</span> execOutcome,
00232                         <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetSeqControl) {
00233 
00234     <span class="comment">// Check that TC packet fits in command load area</span>
00235     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> appDataLength = 6;
00236     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetLength = 11+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>)+appDataLength;
00237     <span class="keywordflow">if</span> ( (tcCmdPos+packetLength)&gt;<a class="code" href="TestConstants_8h.html#a34">TC_COMMAND_AREA_MAX_N_TC</a>*<a class="code" href="TestConstants_8h.html#a35">TC_COMMAND_AREA_MAX_TC_LEN</a> )
00238         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00239 
00240     <span class="comment">// Write TC packet header</span>
00241     <a class="code" href="classTestCasePUSFull.html#b0">writeTcHeader</a>(packetLength-6,packetSeqControl);
00242 
00243     <span class="comment">// Write packet data field header</span>
00244     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = ackField;
00245     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = <a class="code" href="Constants_8h.html#a81">PUS_TYPE_TEST</a>;
00246     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+2) = <a class="code" href="Constants_8h.html#a82">PUS_ST_TC_TEST</a>;
00247     <a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a> tcSrc = <a class="code" href="TestConstants_8h.html#a39">DEF_PUS_TC_SOURCE</a>;
00248     memcpy(tcCommandArea+tcCmdPos+3,&amp;tcSrc,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>));
00249     tcCmdPos = tcCmdPos+3+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>);
00250 
00251     <span class="comment">// Write application data</span>
00252     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)execCounter;
00253     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = execCheckVal;
00254     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+2) = valCheckVal;
00255     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+3) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)execCheckCode;
00256     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+4) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)valCheckCode;
00257     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+5) = execOutcome;
00258     tcCmdPos = tcCmdPos+6;
00259 
00260     <span class="comment">// Write packet error control bytes</span>
00261     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = 0;
00262     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = 0;
00263     tcCmdPos = tcCmdPos+2;
00264 
00265     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00266 }
00267 
<a name="l00268"></a><a class="code" href="classTestCasePUSFull.html#a13">00268</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSFull.html#a13">TestCasePUSFull::writePUSDataReportingControl</a>(
00269                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ackField, <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> NSID, <a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>* sid,
00270                 <a class="code" href="BasicTypes_8h.html#a11">TD_TelecommandSubType</a> tcSubType, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetSeqControl) {
00271 
00272     <span class="comment">// Check that TC packet fits in command load area</span>
00273     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> appDataLength = 1+NSID*<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00274     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetLength = 11+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>)+appDataLength;
00275     <span class="keywordflow">if</span> ( (tcCmdPos+packetLength)&gt;<a class="code" href="TestConstants_8h.html#a34">TC_COMMAND_AREA_MAX_N_TC</a>*<a class="code" href="TestConstants_8h.html#a35">TC_COMMAND_AREA_MAX_TC_LEN</a> )
00276         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00277 
00278     <span class="comment">// Write TC packet header</span>
00279     <a class="code" href="classTestCasePUSFull.html#b0">writeTcHeader</a>(packetLength-6,packetSeqControl);
00280 
00281     <span class="comment">// Write packet data field header</span>
00282     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = ackField;
00283     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = <a class="code" href="Constants_8h.html#a49">PUS_TYPE_DATA_REP</a>;
00284     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+2) = tcSubType;
00285     <a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a> tcSrc = <a class="code" href="TestConstants_8h.html#a39">DEF_PUS_TC_SOURCE</a>;
00286     memcpy(tcCommandArea+tcCmdPos+3,&amp;tcSrc,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>));
00287     tcCmdPos = tcCmdPos+3+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>);
00288 
00289     <span class="comment">// Write application data</span>
00290     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>)NSID;
00291     tcCmdPos++;
00292     <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> i=0; i&lt;NSID; i++) {
00293         memcpy(tcCommandArea+tcCmdPos,&amp;sid[i],<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>));
00294         tcCmdPos = tcCmdPos + <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00295     }
00296 
00297     <span class="comment">// Write packet error control bytes</span>
00298     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = 0;
00299     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = 0;
00300     tcCmdPos = tcCmdPos+2;
00301 
00302     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00303 }
00304 
<a name="l00305"></a><a class="code" href="classTestCasePUSFull.html#a12">00305</a> <span class="keywordtype">bool</span> <a class="code" href="classTestCasePUSFull.html#a12">TestCasePUSFull::writePUSDefineDataReporting</a>(
00306                 <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> ackField, <a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a> collectionInterval, TD_SID sid,
00307                 <a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a> par, <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetSeqControl, TD_TelecommandSubType tcSubType) {
00308 
00309     <span class="comment">// Check that TC packet fits in command load area</span>
00310     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> appDataLength = <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>)+
00311                                  <span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>)+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>);
00312     <span class="keywordtype">unsigned</span> <span class="keywordtype">short</span> packetLength = 11+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>)+appDataLength;
00313     <span class="keywordflow">if</span> ( (tcCmdPos+packetLength)&gt;<a class="code" href="TestConstants_8h.html#a34">TC_COMMAND_AREA_MAX_N_TC</a>*<a class="code" href="TestConstants_8h.html#a35">TC_COMMAND_AREA_MAX_TC_LEN</a> )
00314         <span class="keywordflow">return</span> <span class="keyword">false</span>;
00315 
00316     <span class="comment">// Write TC packet header</span>
00317     <a class="code" href="classTestCasePUSFull.html#b0">writeTcHeader</a>(packetLength-6,packetSeqControl);
00318 
00319     <span class="comment">// Write packet data field header</span>
00320     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = ackField;
00321     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = <a class="code" href="Constants_8h.html#a49">PUS_TYPE_DATA_REP</a>;
00322     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+2) = tcSubType;
00323     <a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a> tcSrc = <a class="code" href="TestConstants_8h.html#a39">DEF_PUS_TC_SOURCE</a>;
00324     memcpy(tcCommandArea+tcCmdPos+3,&amp;tcSrc,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>));
00325     tcCmdPos = tcCmdPos+3+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a12">TD_TelecommandSource</a>);
00326 
00327     <span class="comment">// Write application data</span>
00328     memcpy(tcCommandArea+tcCmdPos,&amp;sid,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>));
00329     tcCmdPos = tcCmdPos+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a21">TD_SID</a>);
00330 
00331     memcpy(tcCommandArea+tcCmdPos,&amp;collectionInterval,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>));
00332     tcCmdPos = tcCmdPos+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a23">TD_PUSCollectionInterval</a>);
00333 
00334     <a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a> npTemp = 1;
00335     memcpy(tcCommandArea+tcCmdPos,&amp;npTemp,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>));
00336     tcCmdPos = tcCmdPos+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a24">TD_PUSNumberOfParameters</a>);
00337 
00338     memcpy(tcCommandArea+tcCmdPos,&amp;par,<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>));
00339     tcCmdPos = tcCmdPos+<span class="keyword">sizeof</span>(<a class="code" href="BasicTypes_8h.html#a16">TD_DataPoolId</a>);
00340 
00341     <span class="comment">// Write packet error control bytes</span>
00342     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos) = 0;
00343     *(<span class="keywordtype">unsigned</span> <span class="keywordtype">char</span>*)(tcCommandArea+tcCmdPos+1) = 0;
00344     tcCmdPos = tcCmdPos+2;
00345 
00346     <span class="keywordflow">return</span> <span class="keyword">true</span>;
00347 }
00348 
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
