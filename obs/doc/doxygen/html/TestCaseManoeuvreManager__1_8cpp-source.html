<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseManoeuvreManager_1.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseManoeuvreManager_1.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseManoeuvreManager_1.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.0</span>
00007 <span class="comment">// Date         08.05.03</span>
00008 <span class="comment">// Author       R. Totaro</span>
00009 
00010 <span class="preprocessor">#include "TestCaseManoeuvreManager_1.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/Constants.h"</span>
00013 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00014 <span class="preprocessor">#include "../Manoeuvre/CC_ManoeuvreManager.h"</span>
00015 <span class="preprocessor">#include "../Manoeuvre/DC_DummyManoeuvre.h"</span>
00016 
<a name="l00017"></a><a class="code" href="classTestCaseManoeuvreManager__1.html#a0">00017</a> <a class="code" href="classTestCaseManoeuvreManager__1.html#a0">TestCaseManoeuvreManager_1::TestCaseManoeuvreManager_1</a>(<span class="keywordtype">void</span>) :
00018         <a class="code" href="classTestCaseWithEvtCheck.html">TestCaseWithEvtCheck</a>(ID_MANOEUVREMANAGER*10+1,"<a class="code" href="classTestCaseManoeuvreManager__1.html">TestCaseManoeuvreManager_1</a>") {
00019         <span class="keywordflow">return</span>;
00020 }
00021 
<a name="l00022"></a><a class="code" href="classTestCaseManoeuvreManager__1.html#a1">00022</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseManoeuvreManager__1.html#a1">TestCaseManoeuvreManager_1::runTestCase</a>(<span class="keywordtype">void</span>) {
00023     <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a> *pMM =<span class="keyword">new</span> <a class="code" href="classCC__ManoeuvreManager.html">CC_ManoeuvreManager</a>();
00024     <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   nEvt=<a class="code" href="classTestCaseWithEvtCheck.html#b0">getNumberOfEvents</a>();
00025         <span class="keyword">const</span> <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>   nMan=8;
00026 
00027     <span class="comment">// Verify correctness of class identifier</span>
00028     <span class="keywordflow">if</span> (pMM-&gt;<a class="code" href="classCC__RootObject.html#a3">getClassId</a>()!=ID_MANOEUVREMANAGER) {
00029                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong class identifier"</span>);
00030                 <span class="keywordflow">return</span>;
00031         }
00032 
00033         <span class="comment">// A newly created ManoeuvreManager shall not be configured</span>
00034         <span class="keywordflow">if</span> (pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a8">isObjectConfigured</a>()) {
00035                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Newly created ManoeuvreManager already configured"</span>);
00036                 <span class="keywordflow">return</span>;
00037         }
00038 
00039         <span class="comment">// Configure the ManoeuvreManager and verify the operation</span>
00040         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a2">setPendingManoeuvreListSize</a>(nMan);
00041         <span class="keywordflow">if</span> (pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a3">getPendingManoeuvreListSize</a>()!=nMan) {
00042                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong getPendingManoeuvreListSize return value"</span>);
00043                 <span class="keywordflow">return</span>;
00044         }
00045 
00046         <span class="comment">// Now it should be configured</span>
00047         <span class="keywordflow">if</span> (!pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a8">isObjectConfigured</a>()) {
00048                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"ManoeuvreManager not configured"</span>);
00049                 <span class="keywordflow">return</span>;
00050         }
00051 
00052         <span class="comment">// Clearly, there shall be no pending manoeuvres</span>
00053         <span class="keywordflow">if</span> (pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a4">getPendingManoeuvres</a>()!=0) {
00054                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Wrong getPendingManoeuvres return value"</span>);
00055                 <span class="keywordflow">return</span>;
00056         }
00057 
00058         <span class="comment">// The following steps check the load(), unload() and abort() methods.</span>
00059         <span class="comment">// Let's create an array of DC_DummyManoeuvre pointers to be used in the</span>
00060         <span class="comment">// subsequent tests.</span>
00061         <a class="code" href="classDC__DummyManoeuvre.html">DC_DummyManoeuvre</a> *pDM[nMan+1];
00062 
00063         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0; i&lt;=nMan; i++)
00064         pDM[i]=<span class="keyword">new</span> <a class="code" href="classDC__DummyManoeuvre.html">DC_DummyManoeuvre</a>();
00065 
00066         <span class="keywordflow">for</span> (<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> i=0;i&lt;nMan;i++) {
00067                 <span class="comment">// Load the manouvre</span>
00068                 pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a5">load</a>(pDM[i]);
00069 
00070                 <span class="comment">// Verify that manCounter is incremented</span>
00071                 <span class="keywordflow">if</span> (pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a4">getPendingManoeuvres</a>()!=(i+1)) {
00072                         setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"manCounter was not incremented"</span>);
00073                         <span class="keywordflow">return</span>;
00074                 }
00075 
00076                 <span class="comment">// Set the "in use" flag</span>
00077         pDM[i]-&gt;<a class="code" href="classManoeuvre.html#a9">setInUse</a>(<span class="keyword">true</span>);
00078         }
00079 
00080         <span class="comment">// A manoeuvre is aborted and the effect of the operation verified</span>
00081         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a6">abort</a>(pDM[nMan-1]);
00082         <span class="keywordflow">if</span> (pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a4">getPendingManoeuvres</a>()!=(nMan-1)) {
00083                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"manCounter was not decremented"</span>);
00084                 <span class="keywordflow">return</span>;
00085         }
00086 
00087         <span class="comment">// Check that the manouvre is no longer in use</span>
00088         <span class="keywordflow">if</span> (pDM[nMan-1]-&gt;<a class="code" href="classManoeuvre.html#a10">isInUse</a>()) {
00089                 setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Aborted manoeuvre still in use"</span>);
00090                 <span class="keywordflow">return</span>;
00091         }
00092 
00093         <span class="comment">// Load the previously aborted manoeuvre</span>
00094         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a5">load</a>(pDM[nMan-1]);
00095 
00096         <span class="comment">// Try loading more manoeuvres that the allocated space and verify</span>
00097         <span class="comment">// that the event is reported.</span>
00098         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a5">load</a>(pDM[nMan]);
00099         <span class="keywordflow">if</span> (!verifyLatestEvent((nEvt+nMan+3),EVT_MAN_LIST_FULL))
00100                 <span class="keywordflow">return</span>;
00101 
00102         <span class="comment">// Finally, let's reset the manoeuvre manager and verify that all</span>
00103         <span class="comment">// the pending manoeuvres are aborted.</span>
00104         pMM-&gt;<a class="code" href="classCC__ManoeuvreManager.html#a1">reset</a>();
00105         <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i=0;i&lt;nMan;i++) {
00106                 <span class="keywordflow">if</span> (pDM[i]-&gt;<a class="code" href="classManoeuvre.html#a10">isInUse</a>()) {
00107                         setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>,<span class="stringliteral">"Reset failed to abort a manoeuvre"</span>);
00108                         <span class="keywordflow">return</span>;
00109                 }
00110         }
00111 
00112         setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00113         <span class="keywordflow">return</span>;
00114 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
