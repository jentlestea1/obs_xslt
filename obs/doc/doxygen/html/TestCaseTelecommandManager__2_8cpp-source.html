<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=iso-8859-1">
<title>OBS Framework: TestCaseTelecommandManager_2.cpp Source File</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.3.7 -->
<div class="qindex"><a class="qindex" href="index.html">Main&nbsp;Page</a> | <a class="qindex" href="modules.html">Modules</a> | <a class="qindex" href="hierarchy.html">Class&nbsp;Hierarchy</a> | <a class="qindex" href="classes.html">Alphabetical&nbsp;List</a> | <a class="qindex" href="annotated.html">Class&nbsp;List</a> | <a class="qindex" href="files.html">File&nbsp;List</a> | <a class="qindex" href="functions.html">Class&nbsp;Members</a> | <a class="qindex" href="globals.html">File&nbsp;Members</a> | <a class="qindex" href="pages.html">Related&nbsp;Pages</a></div>
<h1>TestCaseTelecommandManager_2.cpp</h1><pre class="fragment"><div>00001 <span class="comment">//</span>
00002 <span class="comment">// Copyright 2004 P&amp;P Software GmbH - All Rights Reserved</span>
00003 <span class="comment">//</span>
00004 <span class="comment">// TestCaseTelecommandManager_2.cpp</span>
00005 <span class="comment">//</span>
00006 <span class="comment">// Version      1.1</span>
00007 <span class="comment">// Date         11.04.03</span>
00008 <span class="comment">// Author       A. Pasetti (P&amp;P Software)</span>
00009 
00010 <span class="preprocessor">#include "../GeneralInclude/CompilerSwitches.h"</span>
00011 <span class="preprocessor">#include "../GeneralInclude/ClassId.h"</span>
00012 <span class="preprocessor">#include "../GeneralInclude/TestConstants.h"</span>
00013 <span class="preprocessor">#include "../Base/CC_RootObject.h"</span>
00014 <span class="preprocessor">#include "../Event/DC_EventRepository.h"</span>
00015 <span class="preprocessor">#include "../Telecommand/DC_DummyTelecommandLoader.h"</span>
00016 <span class="preprocessor">#include "../Telecommand/CC_TelecommandManager.h"</span>
00017 <span class="preprocessor">#include "../System/DC_DummyObsClock.h"</span>
00018 <span class="preprocessor">#include "../Telecommand/TelecommandLoader.h"</span>
00019 <span class="preprocessor">#include "../Telecommand/DC_DummyTelecommand.h"</span>
00020 <span class="preprocessor">#include "TestCaseTelecommandManager_2.h"</span>
00021 
<a name="l00022"></a><a class="code" href="classTestCaseTelecommandManager__2.html#a0">00022</a> <a class="code" href="classTestCaseTelecommandManager__2.html#a0">TestCaseTelecommandManager_2::TestCaseTelecommandManager_2</a>(<span class="keywordtype">void</span>) :
00023         <a class="code" href="classTestCaseGenericSetUp.html">TestCaseGenericSetUp</a>(ID_TELECOMMANDMANAGER*10+2,"<a class="code" href="classTestCaseTelecommandManager__2.html">TestCaseTelecommandManager_2</a>") {
00024                 <span class="keywordflow">return</span>;
00025 }
00026 
<a name="l00027"></a><a class="code" href="classTestCaseTelecommandManager__2.html#a1">00027</a> <span class="keywordtype">void</span> <a class="code" href="classTestCaseTelecommandManager__2.html#a1">TestCaseTelecommandManager_2::runTestCase</a>(<span class="keywordtype">void</span>) {
00028 
00029    <span class="comment">// Create the telecommand manager</span>
00030    <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>* pTcm = <span class="keyword">new</span> <a class="code" href="classCC__TelecommandManager.html">CC_TelecommandManager</a>();
00031 
00032    <span class="comment">// Define the identifiers and time tags for the dummy telecommands</span>
00033    <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tcTt1 = 3;
00034    <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tcTt2 = 5;
00035    <a class="code" href="BasicTypes_8h.html#a2">TD_ObsTime</a> tcTt3 = 0;
00036    <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId1 = 1;
00037    <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId2 = 2;
00038    <a class="code" href="BasicTypes_8h.html#a9">TD_TelecommandId</a> tcId3 = 3;
00039 
00040    <span class="comment">// Create and load an OBS clock</span>
00041    <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>* pClk = <span class="keyword">new</span> <a class="code" href="classDC__DummyObsClock.html">DC_DummyObsClock</a>();
00042    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a5">setTime</a>(tcTt1-1);
00043    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a6">setCycle</a>(0);
00044    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a11">setObsClock</a>(pClk);
00045 
00046    <span class="comment">// Create and configure the three dummy telecommands</span>
00047    <a class="code" href="classDC__DummyTelecommand.html">DC_DummyTelecommand</a>* pTc1 = <span class="keyword">new</span> <a class="code" href="classDC__DummyTelecommand.html">DC_DummyTelecommand</a>();
00048    DC_DummyTelecommand* pTc2 = <span class="keyword">new</span> DC_DummyTelecommand();
00049    DC_DummyTelecommand* pTc3 = <span class="keyword">new</span> DC_DummyTelecommand();
00050    pTc1-&gt;<a class="code" href="classTelecommand.html#a6">setTelecommandId</a>(tcId1);
00051    pTc2-&gt;<a class="code" href="classTelecommand.html#a6">setTelecommandId</a>(tcId2);
00052    pTc3-&gt;<a class="code" href="classTelecommand.html#a6">setTelecommandId</a>(tcId3);
00053    pTc1-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(tcTt1);
00054    pTc2-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(tcTt2);
00055    pTc3-&gt;<a class="code" href="classTelecommand.html#a14">setTimeTag</a>(tcTt3);
00056 
00057    <span class="comment">// Create, configure and load a dummy telecommand loader</span>
00058    <a class="code" href="classDC__DummyTelecommandLoader.html">DC_DummyTelecommandLoader</a>* pTcl = <span class="keyword">new</span> <a class="code" href="classDC__DummyTelecommandLoader.html">DC_DummyTelecommandLoader</a>();
00059    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(0,pTc1);
00060    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(1,pTc2);
00061    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a3">setSampleTelecommand</a>(2,pTc3);
00062    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a9">setTelecommandLoader</a>(pTcl);
00063    pTcl-&gt;<a class="code" href="classTelecommandLoader.html#a3">setTelecommandManager</a>(pTcm);
00064 
00065    <span class="comment">// Set the pending telecommand list size</span>
00066    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a2">setPendingTelecommandListSize</a>(10);
00067 
00068    <span class="comment">// Check that the telecommand manager is configured</span>
00069    <span class="keywordflow">if</span> ( !pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a14">isObjectConfigured</a>() )
00070    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong configuration status"</span>);
00071         <span class="keywordflow">return</span>;
00072    }
00073 
00074    <span class="comment">// Activate the telecommand loader three times and check that dummy</span>
00075    <span class="comment">// telecommands were loaded in telecommand manager</span>
00076    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00077    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00078    pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a1">activate</a>();
00079    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>() != 3 )
00080    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00081         <span class="keywordflow">return</span>;
00082    }
00083 
00084    <span class="comment">// Check allocation counter value</span>
00085    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 3 )
00086    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00087         <span class="keywordflow">return</span>;
00088    }
00089 
00090    <span class="comment">// Activate the telecommand manager and check that the third</span>
00091    <span class="comment">// telecommand is executed</span>
00092    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00093    <span class="keywordflow">if</span> (pTc3-&gt;<a class="code" href="classDC__DummyTelecommand.html#a1">getExecutionCounter</a>() != 1)
00094    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Third telecommand was not executed"</span>);
00095         <span class="keywordflow">return</span>;
00096    }
00097 
00098    <span class="comment">// Check number of pending telecommands</span>
00099    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>() != 2 )
00100    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00101         <span class="keywordflow">return</span>;
00102    }
00103 
00104    <span class="comment">// Check generation of event to record telecommand successful execution and unloading</span>
00105    <a class="code" href="classDC__EventRepository.html">DC_EventRepository</a>* pRep = <a class="code" href="classCC__RootObject.html#e4">CC_RootObject::getEventRepository</a>();
00106    pRep-&gt;<a class="code" href="classDC__EventRepository.html#a7">latest</a>();
00107    <span class="keywordflow">if</span> ( (pRep-&gt;<a class="code" href="classDC__EventRepository.html#a10">getEventType</a>() != EVT_TC_EXEC_SUCC) )
00108    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong unload event"</span>);
00109         <span class="keywordflow">return</span>;
00110    }
00111 
00112    <span class="comment">// Activate telecommand manager and advance dummy time to the point</span>
00113    <span class="comment">// where the first telecommand should be executed and check execution</span>
00114    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00115    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00116    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a5">setTime</a>(tcTt1+1);
00117    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a6">setCycle</a>(0);
00118    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00119    <span class="keywordflow">if</span> (pTc1-&gt;<a class="code" href="classDC__DummyTelecommand.html#a1">getExecutionCounter</a>() != 1)
00120    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"First telecommand was not executed"</span>);
00121         <span class="keywordflow">return</span>;
00122    }
00123 
00124    <span class="comment">// Check number of pending telecommands</span>
00125    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>() != 1 )
00126    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00127         <span class="keywordflow">return</span>;
00128    }
00129 
00130    <span class="comment">// Activate telecommand manager and advance dummy time to the point</span>
00131    <span class="comment">// where the second telecommand should be executed and check execution</span>
00132    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00133    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00134    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a5">setTime</a>(tcTt2+1);
00135    pClk-&gt;<a class="code" href="classDC__DummyObsClock.html#a6">setCycle</a>(0);
00136    pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a13">activate</a>();
00137    <span class="keywordflow">if</span> (pTc2-&gt;<a class="code" href="classDC__DummyTelecommand.html#a1">getExecutionCounter</a>() != 1)
00138    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Second telecommand was not executed"</span>);
00139         <span class="keywordflow">return</span>;
00140    }
00141 
00142    <span class="comment">// Check number of pending telecommands</span>
00143    <span class="keywordflow">if</span> ( pTcm-&gt;<a class="code" href="classCC__TelecommandManager.html#a4">getPendingTelecommands</a>() != 0 )
00144    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong number of pending telecommands"</span>);
00145         <span class="keywordflow">return</span>;
00146    }
00147 
00148    <span class="comment">// Check allocation counter value</span>
00149    <span class="keywordflow">if</span> ( pTcl-&gt;<a class="code" href="classDC__DummyTelecommandLoader.html#a4">getAllocationCounter</a>() != 0 )
00150    {    setTestResult(<a class="code" href="TestConstants_8h.html#a1">TEST_FAILURE</a>, <span class="stringliteral">"Wrong allocation counter value"</span>);
00151         <span class="keywordflow">return</span>;
00152    }
00153 
00154    setTestResult(<a class="code" href="TestConstants_8h.html#a0">TEST_SUCCESS</a>,<span class="stringliteral">"Test Successful"</span>);
00155    <span class="keywordflow">return</span>;
00156 
00157 }
</div></pre><center>
<b>Copyright 2003 <a href="http://www.pnp-software.com/" target="_parent">P&P Software GmbH</a> - All Rights Reserved</b>
</center>
